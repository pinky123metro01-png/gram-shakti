<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§∂‡§ï‡•ç‡§§‡§ø - ‡§Æ‡§æ‡§∏‡•ç‡§ü‡§∞ ‡§ï‡§Ç‡§ü‡•ç‡§∞‡•ã‡§≤ ‡§™‡•à‡§®‡§≤</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body { font-family: sans-serif; background: #f4f7f6; }
        .tab-btn { padding: 10px 20px; cursor: pointer; border-bottom: 3px solid transparent; }
        .tab-btn.active { border-bottom: 3px solid #ea580c; color: #ea580c; font-weight: bold; }
    </style>
</head>
<body>

    <div id="login-screen" class="max-w-md mx-auto mt-20 bg-white p-8 rounded-2xl shadow-2xl">
        <h2 class="text-3xl font-bold text-center text-orange-600 mb-6">‡§è‡§°‡§Æ‡§ø‡§® ‡§≤‡•â‡§ó‡§ø‡§®</h2>
        <label class="block mb-2 font-bold text-gray-700">‡§≤‡•â‡§ó‡§ø‡§® ID:</label>
        <input type="text" id="login_id" class="w-full p-3 border rounded-lg mb-4" placeholder="‡§Ö‡§™‡§®‡•Ä ID ‡§°‡§æ‡§≤‡•á‡§Ç">
        <label class="block mb-2 font-bold text-gray-700">‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°:</label>
        <input type="password" id="login_pass" class="w-full p-3 border rounded-lg mb-6" placeholder="‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§°‡§æ‡§≤‡•á‡§Ç">
        <button onclick="handleLogin()" class="w-full bg-orange-600 text-white p-4 rounded-lg font-bold text-lg hover:bg-orange-700">‡§™‡•ç‡§∞‡§µ‡•á‡§∂ ‡§ï‡§∞‡•á‡§Ç</button>
        <p class="text-center mt-4 text-sm text-gray-500">‡§Æ‡§æ‡§∏‡•ç‡§ü‡§∞ ‡§ï‡•ç‡§∞‡•á‡§°‡•á‡§Ç‡§∂‡§ø‡§Ø‡§≤ ‡§∏‡•á ‡§∏‡•Å‡§™‡§∞ ‡§ï‡§Ç‡§ü‡•ç‡§∞‡•ã‡§≤ ‡§ñ‡•Å‡§≤‡§§‡§æ ‡§π‡•à</p>
    </div>

    <div id="main-dashboard" class="hidden container mx-auto p-4">
        <div class="flex justify-between items-center bg-white p-4 rounded-xl shadow-md mb-6">
            <h1 id="welcome-note" class="text-xl font-bold text-blue-800">‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§°</h1>
            <button onclick="location.reload()" class="bg-red-500 text-white px-4 py-2 rounded-lg text-sm">‡§≤‡•â‡§ó ‡§Ü‡§â‡§ü</button>
        </div>

        <div id="super-tabs" class="flex gap-4 mb-6 bg-white p-2 rounded-lg shadow hidden">
            <div id="tab1" class="tab-btn active" onclick="switchTab('workers')">‡§µ‡§∞‡•çker ‡§≤‡§ø‡§∏‡•ç‡§ü</div>
            <div id="tab2" class="tab-btn" onclick="switchTab('admins')">‡§ú‡§ø‡§≤‡§æ ‡§è‡§°‡§Æ‡§ø‡§® ‡§Æ‡•à‡§®‡•á‡§ú‡§Æ‡•á‡§Ç‡§ü</div>
        </div>

        <div id="worker-section" class="bg-white p-4 rounded-xl shadow-md overflow-x-auto">
            <h3 class="font-bold text-lg mb-4 border-b pb-2">‡§™‡§Ç‡§ú‡•Ä‡§ï‡•É‡§§ ‡§µ‡§∞‡•ç‡§ï‡§∞ ‡§î‡§∞ ‡§ï‡§Ç‡§™‡§®‡§ø‡§Ø‡§æ‡§Å</h3>
            <table class="w-full text-left border-collapse">
                <thead>
                    <tr class="bg-gray-100 border-b">
                        <th class="p-3">‡§®‡§æ‡§Æ</th>
                        <th class="p-3">‡§ï‡§æ‡§Æ</th>
                        <th class="p-3">‡§≤‡•ã‡§ï‡•á‡§∂‡§®</th>
                        <th class="p-3">‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï</th>
                        <th class="p-3">‡§π‡§ü‡§æ‡§è‡§Ç</th>
                    </tr>
                </thead>
                <tbody id="worker-list-body"></tbody>
            </table>
        </div>

        <div id="admin-management" class="hidden mt-6">
            <div class="bg-white p-6 rounded-xl shadow-md mb-6 border-l-4 border-green-500">
                <h3 class="font-bold text-lg mb-4 text-green-700">‡§®‡§Ø‡§æ ‡§ú‡§ø‡§≤‡§æ ‡§è‡§°‡§Æ‡§ø‡§® ‡§ú‡•ã‡•ú‡•á‡§Ç</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <input type="text" id="new_adm_name" placeholder="‡§®‡§æ‡§Æ" class="p-3 border rounded">
                    <input type="text" id="new_adm_state" placeholder="‡§∞‡§æ‡§ú‡•ç‡§Ø" class="p-3 border rounded">
                    <input type="text" id="new_adm_jila" placeholder="‡§ú‡§ø‡§≤‡§æ" class="p-3 border rounded">
                    <input type="tel" id="new_adm_phone" placeholder="‡§≤‡•â‡§ó‡§ø‡§® ID (Mobile)" class="p-3 border rounded">
                    <input type="text" id="new_adm_pass" placeholder="‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§¨‡§®‡§æ‡§Ø‡•á‡§Ç" class="p-3 border rounded">
                    <button onclick="createAdmin()" class="bg-green-600 text-white p-3 rounded-lg font-bold">‡§è‡§°‡§Æ‡§ø‡§® ‡§ú‡•ã‡•ú‡•á‡§Ç +</button>
                </div>
            </div>
            <div id="admin-list-body"></div>
        </div>
    </div>

<script>
// Firebase Config
const firebaseConfig = {
    apiKey: "AIzaSyCuvev3-jwZwQuO_fHYyv2E2ovLny4Lh8Q",
    authDomain: "gram-shakti-b135a.firebaseapp.com",
    databaseURL: "https://gram-shakti-b135a-default-rtdb.firebaseio.com",
    projectId: "gram-shakti-b135a"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// --- ‡§Ø‡§π‡§æ‡§Å ‡§Ü‡§™‡§ï‡•Ä ID ‡§î‡§∞ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§∏‡•á‡§ü ‡§ï‡§∞ ‡§¶‡§ø‡§è ‡§ó‡§è ‡§π‡•à‡§Ç ---
const MASTER_ID = "Vikash"; 
const MASTER_PASS = "Vikas0627."; 

let currentUser = null;

function handleLogin() {
    const id = document.getElementById('login_id').value.trim();
    const pass = document.getElementById('login_pass').value.trim();

    if(id === MASTER_ID && pass === MASTER_PASS) {
        currentUser = { role: 'super', name: '‡§µ‡§ø‡§ï‡§æ‡§∏ ‡§≠‡§æ‡§à (Master Admin)' };
        openDashboard();
        return;
    }

    db.ref('district_admins/' + id).once('value', snap => {
        const d = snap.val();
        if(d && d.pass === pass) {
            currentUser = { role: 'district', name: d.name, jila: d.jila.toLowerCase(), state: d.state };
            openDashboard();
        } else {
            alert("‡§≤‡•â‡§ó‡§ø‡§® ID ‡§Ø‡§æ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§ó‡§≤‡§§ ‡§π‡•à!");
        }
    });
}

function openDashboard() {
    document.getElementById('login-screen').classList.add('hidden');
    document.getElementById('main-dashboard').classList.remove('hidden');
    document.getElementById('welcome-note').innerText = "‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à, " + currentUser.name;

    if(currentUser.role === 'super') {
        document.getElementById('super-tabs').classList.remove('hidden');
        loadAllWorkers();
        loadAllAdmins();
    } else {
        loadDistrictWorkers(currentUser.jila);
    }
}

function switchTab(type) {
    document.getElementById('tab1').classList.remove('active');
    document.getElementById('tab2').classList.remove('active');
    document.getElementById('worker-section').classList.add('hidden');
    document.getElementById('admin-management').classList.add('hidden');

    if(type === 'workers') {
        document.getElementById('tab1').classList.add('active');
        document.getElementById('worker-section').classList.remove('hidden');
    } else {
        document.getElementById('tab2').classList.add('active');
        document.getElementById('admin-management').classList.remove('hidden');
    }
}

function loadAllWorkers() {
    db.ref('users/').on('value', snap => {
        renderWorkerTable(snap);
    });
}

function loadDistrictWorkers(targetJila) {
    db.ref('users/').on('value', snap => {
        renderWorkerTable(snap, targetJila);
    });
}

function renderWorkerTable(snap, filterJila = null) {
    let html = "";
    snap.forEach(child => {
        let d = child.val();
        if(filterJila && d.jila !== filterJila) return;
        html += `<tr class="border-b hover:bg-gray-50 text-sm">
            <td class="p-3"><b>${d.name}</b><br><span class="text-xs text-blue-600">${d.type}</span></td>
            <td class="p-3">${d.post}</td>
            <td class="p-3">${d.village.toUpperCase()}, ${d.jila.toUpperCase()}</td>
            <td class="p-3"><a href="tel:${d.phone}" class="text-green-600 font-bold">üìû ${d.phone}</a></td>
            <td class="p-3"><button onclick="deleteRecord('${child.key}')" class="text-red-500">‚ùå</button></td>
        </tr>`;
    });
    document.getElementById('worker-list-body').innerHTML = html || "<tr><td colspan='5' class='text-center p-4'>‡§°‡•á‡§ü‡§æ ‡§Æ‡•å‡§ú‡•Ç‡§¶ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à</td></tr>";
}

function createAdmin() {
    let data = {
        name: document.getElementById('new_adm_name').value,
        state: document.getElementById('new_adm_state').value,
        jila: document.getElementById('new_adm_jila').value,
        phone: document.getElementById('new_adm_phone').value,
        pass: document.getElementById('new_adm_pass').value
    };
    if(!data.phone || !data.pass) return alert("‡§∏‡§≠‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§≠‡§∞‡•á‡§Ç!");
    db.ref('district_admins/' + data.phone).set(data).then(() => {
        alert("‡§ú‡§ø‡§≤‡§æ ‡§è‡§°‡§Æ‡§ø‡§® ‡§∏‡§´‡§≤‡§§‡§æ ‡§∏‡•á ‡§¨‡§®‡§æ‡§Ø‡§æ ‡§ó‡§Ø‡§æ!");
    });
}

function loadAllAdmins() {
    db.ref('district_admins/').on('value', snap => {
        let html = "<table class='w-full text-left mt-4 border'>";
        html += "<tr class='bg-gray-200'><th class='p-2'>‡§®‡§æ‡§Æ</th><th class='p-2'>‡§ú‡§ø‡§≤‡§æ</th><th class='p-2'>‡§≤‡•â‡§ó‡§ø‡§® ID</th><th class='p-2'>‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°</th><th class='p-2'>‡§π‡§ü‡§æ‡§è‡§Ç</th></tr>";
        snap.forEach(child => {
            let d = child.val();
            html += `<tr class="border-b"><td class="p-2">${d.name}</td><td class="p-2">${d.jila}</td><td class="p-2">${d.phone}</td><td class="p-2">${d.pass}</td><td class="p-2"><button onclick="deleteAdmin('${child.key}')" class="text-red-500 font-bold">‡§π‡§ü‡§æ‡§è‡§Ç</button></td></tr>`;
        });
        html += "</table>";
        document.getElementById('admin-list-body').innerHTML = html;
    });
}

function deleteRecord(key) { if(confirm("‡§°‡§ø‡§≤‡•Ä‡§ü ‡§ï‡§∞‡•á‡§Ç?")) db.ref('users/' + key).remove(); }
function deleteAdmin(id) { if(confirm("‡§è‡§°‡§Æ‡§ø‡§® ‡§π‡§ü‡§æ‡§è‡§Ç?")) db.ref('district_admins/' + id).remove(); }
</script>
</body>
</html>
