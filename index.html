<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§∂‡§ï‡•ç‡§§‡§ø - ‡§°‡§ø‡§ú‡§ø‡§ü‡§≤ ‡§∏‡•á‡§µ‡§æ</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans Devanagari', sans-serif; background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('https://images.unsplash.com/photo-1500382017468-9049fed747ef?auto=format&fit=crop&w=1200&q=80'); background-size: cover; background-attachment: fixed; min-height: 100vh; display: flex; flex-direction: column; align-items: center; padding: 10px; }
        .app-card { background: rgba(255, 255, 255, 0.95); width: 100%; max-width: 480px; padding: 20px; border-radius: 25px; box-shadow: 0 15px 35px rgba(0,0,0,0.4); backdrop-filter: blur(10px); margin: 10px 0; }
        .ad-box { width: 100%; max-width: 480px; height: 80px; background: #fff; border-radius: 15px; overflow: hidden; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 10px rgba(0,0,0,0.2); border: 2px solid #f97316; cursor:pointer; }
        .ad-box img { width: 100%; height: 100%; object-fit: cover; }
        .btn-main { width: 100%; padding: 15px; background: #f97316; color: white; border-radius: 14px; font-size: 18px; font-weight: 700; cursor: pointer; margin-top: 10px; border: none; }
        input, select { width: 100%; padding: 12px; margin-bottom: 10px; border-radius: 10px; border: 1px solid #ddd; color: #000; }
        .list-item { background: white; padding: 15px; border-radius: 15px; margin-bottom: 10px; border-left: 6px solid #16a34a; box-shadow: 0 4px 10px rgba(0,0,0,0.1); color: #333; }
    </style>
</head>
<body>

    <div class="ad-box" onclick="contactAdmin()">
        <img src="1770902092682 (1).png" onerror="this.src='https://via.placeholder.com/480x80?text=Top+Advertisement'">
    </div>

    <div class="app-card" id="main-container">
        <div id="content-area">
            <h1 class="text-3xl font-bold text-center text-orange-600">‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§∂‡§ï‡•ç‡§§‡§ø</h1>
            <p class="text-center text-gray-600 mb-6">‡§ó‡§æ‡§Å‡§µ ‡§ï‡§æ ‡§π‡•Å‡§®‡§∞, ‡§∂‡§π‡§∞ ‡§ï‡§æ ‡§¨‡§æ‡§ú‡§º‡§æ‡§∞</p>
            <button class="btn-main" onclick="showLocationStep('search')">üîé ‡§µ‡§∞‡•ç‡§ï‡§∞/‡§∏‡§æ‡§Æ‡§æ‡§® ‡§¢‡•Ç‡§Å‡§¢‡•á‡§Ç</button>
            <button class="btn-main" style="background:#1a1a1a" onclick="showLocationStep('reg')">üì¢ ‡§Ö‡§™‡§®‡§æ ‡§ï‡§æ‡§Æ ‡§ú‡•ã‡•ú‡•á‡§Ç</button>
            <button class="btn-main" style="background:#2563eb" onclick="contactAdmin()">üí¨ ‡§è‡§°‡§Æ‡§ø‡§® ‡§∏‡•á ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï</button>
        </div>
    </div>

    <div class="ad-box" onclick="contactAdmin()">
        <img src="1770902092682 (2).png" onerror="this.src='https://via.placeholder.com/480x80?text=Bottom+Advertisement'">
    </div>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyCuvev3-jwZwQuO_fHYyv2E2ovLny4Lh8Q",
    authDomain: "gram-shakti-b135a.firebaseapp.com",
    databaseURL: "https://gram-shakti-b135a-default-rtdb.firebaseio.com",
    projectId: "gram-shakti-b135a"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let temp = { mode: '', village: '', service: '' };

function contactAdmin() {
    window.open(`https://wa.me/919784499059?text=‡§®‡§Æ‡§∏‡•ç‡§§‡•á ‡§∞‡§µ‡§ø ‡§≠‡§æ‡§à, ‡§µ‡§ø‡§ú‡•ç‡§û‡§æ‡§™‡§® ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§ï‡§ø‡§Ø‡§æ ‡§π‡•à‡•§`, '_blank');
}

// Step 1: ‡§≤‡•ã‡§ï‡•á‡§∂‡§® ‡§™‡•Ç‡§õ‡§®‡§æ (‡§Ø‡§π‡•Ä ‡§ó‡§æ‡§Å‡§µ ‡§°‡•á‡§ü‡§æ ‡§´‡§ø‡§≤‡•ç‡§ü‡§∞ ‡§ï‡§∞‡•á‡§ó‡§æ)
function showLocationStep(mode) {
    temp.mode = mode;
    document.getElementById('content-area').innerHTML = `
        <h2 class="text-xl font-bold mb-4">‡§≤‡•ã‡§ï‡•á‡§∂‡§® ‡§≠‡§∞‡•á‡§Ç</h2>
        <input type="text" id="vName" placeholder="‡§Ö‡§™‡§®‡•á ‡§ó‡§æ‡§Å‡§µ ‡§Ø‡§æ ‡§∂‡§π‡§∞ ‡§ï‡§æ ‡§®‡§æ‡§Æ">
        <button class="btn-main" onclick="saveLoc()">‡§Ü‡§ó‡•á ‡§¨‡•ù‡•á‡§Ç</button>
        <button class="mt-4 text-blue-600" onclick="location.reload()">‚Üê ‡§µ‡§æ‡§™‡§∏</button>
    `;
}

function saveLoc() {
    temp.village = document.getElementById('vName').value.trim().toLowerCase();
    if(!temp.village) return alert("‡§ó‡§æ‡§Å‡§µ ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§≤‡§ø‡§ñ‡•á‡§Ç");
    showServiceStep();
}

// Step 2: ‡§∏‡§∞‡•ç‡§µ‡§ø‡§∏ ‡§ö‡•Å‡§®‡§®‡§æ
function showServiceStep() {
    const services = ['‡§Æ‡§ø‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä', '‡§á‡§≤‡•á‡§ï‡•ç‡§ü‡•ç‡§∞‡•Ä‡§∂‡§ø‡§Ø‡§®', 'JCB/‡§ü‡•ç‡§∞‡•à‡§ï‡•ç‡§ü‡§∞', '‡§°‡•á‡§Ø‡§∞‡•Ä/‡§¶‡•Ç‡§ß', '‡§ï‡§ø‡§∞‡§æ‡§®‡§æ ‡§¶‡•Å‡§ï‡§æ‡§®', '‡§Æ‡§ú‡§¶‡•Ç‡§∞'];
    let html = `<h2 class="text-xl font-bold mb-4">‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä ‡§ö‡•Å‡§®‡•á‡§Ç</h2>`;
    services.forEach(s => {
        html += `<button class="btn-main" style="background:white; color:#333; border:1px solid #ddd" onclick="setService('${s}')">${s}</button>`;
    });
    document.getElementById('content-area').innerHTML = html;
}

function setService(s) {
    temp.service = s;
    if(temp.mode === 'search') fetchWorkers();
    else showRegForm();
}

// Step 3: ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•á‡§∂‡§® ‡§´‡•â‡§∞‡•ç‡§Æ (‡§°‡•á‡§ü‡§æ ‡§∏‡•á‡§µ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è)
function showRegForm() {
    document.getElementById('content-area').innerHTML = `
        <h2 class="text-xl font-bold mb-4">${temp.service} ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•á‡§∂‡§®</h2>
        <input type="text" id="wName" placeholder="‡§Ü‡§™‡§ï‡§æ/‡§¶‡•Å‡§ï‡§æ‡§® ‡§ï‡§æ ‡§®‡§æ‡§Æ">
        <input type="tel" id="wPhone" placeholder="‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞">
        <select id="wDel"><option value="false">‡§π‡•ã‡§Æ ‡§°‡§ø‡§≤‡•Ä‡§µ‡§∞‡•Ä ‡§®‡§π‡•Ä‡§Ç</option><option value="true">‡§π‡•ã‡§Æ ‡§°‡§ø‡§≤‡•Ä‡§µ‡§∞‡•Ä ‡§π‡§æ‡§Å</option></select>
        <button class="btn-main" onclick="saveToFirebase()">‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç</button>
    `;
}

function saveToFirebase() {
    let name = document.getElementById('wName').value;
    let phone = document.getElementById('wPhone').value;
    let del = document.getElementById('wDel').value;

    if(!name || !phone) return alert("‡§®‡§æ‡§Æ ‡§î‡§∞ ‡§®‡§Ç‡§¨‡§∞ ‡§≠‡§∞‡•á‡§Ç");

    db.ref('users/').push({
        name: name,
        phone: phone,
        village: temp.village,
        service: temp.service,
        delivery: del,
        role: 'worker'
    }).then(() => {
        alert("‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§ú‡•Å‡•ú ‡§ó‡§è!");
        location.reload();
    });
}

// Step 4: ‡§∏‡§∞‡•ç‡§ö ‡§∞‡§ø‡§ú‡§≤‡•ç‡§ü‡•ç‡§∏ (‡§ú‡•ã ‡§≠‡§∞‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à ‡§µ‡§π‡•Ä ‡§Ø‡§π‡§æ‡§Å ‡§¶‡§ø‡§ñ‡•á‡§ó‡§æ)
function fetchWorkers() {
    document.getElementById('content-area').innerHTML = `<h2 class="text-xl font-bold mb-4">${temp.service} ‡§ï‡•Ä ‡§≤‡§ø‡§∏‡•ç‡§ü</h2><div id="results">‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</div>`;
    
    db.ref('users/').once('value', snap => {
        let html = "";
        let count = 0;
        snap.forEach(child => {
            let d = child.val();
            // ‡§´‡§ø‡§≤‡•ç‡§ü‡§∞: ‡§ó‡§æ‡§Å‡§µ ‡§î‡§∞ ‡§∏‡§∞‡•ç‡§µ‡§ø‡§∏ ‡§¶‡•ã‡§®‡•ã‡§Ç ‡§Æ‡•à‡§ö ‡§π‡•ã‡§®‡•Ä ‡§ö‡§æ‡§π‡§ø‡§è
            if(d.village === temp.village && d.service === temp.service) {
                html += `
                    <div class="list-item">
                        <div class="flex justify-between items-center">
                            <div>
                                <b class="text-lg">${d.name}</b><br>
                                <span class="text-sm">${d.delivery === 'true' ? 'üöö ‡§°‡§ø‡§≤‡•Ä‡§µ‡§∞‡•Ä ‡§â‡§™‡§≤‡§¨‡•ç‡§ß' : 'üè† ‡§¶‡•Å‡§ï‡§æ‡§® ‡§™‡§∞'}</span>
                            </div>
                            <a href="tel:${d.phone}" class="bg-green-500 text-white p-2 rounded-full">üìû</a>
                        </div>
                    </div>`;
                count++;
            }
        });
        document.getElementById('results').innerHTML = count > 0 ? html : "‡§á‡§∏ ‡§ó‡§æ‡§Å‡§µ ‡§Æ‡•á‡§Ç ‡§Ö‡§≠‡•Ä ‡§ï‡•ã‡§à ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§";
        document.getElementById('content-area').innerHTML += `<button class="btn-main" style="background:#000" onclick="location.reload()">‡§µ‡§æ‡§™‡§∏</button>`;
    });
}
</script>
</body>
</html>
