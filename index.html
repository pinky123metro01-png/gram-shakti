<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gram Shakti | Full Categories & Ads</title>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Hind:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Hind', sans-serif; background-color: #f8fafc; padding-bottom: 70px; }
        .btn-main { background: #ea580c; color: white; padding: 12px; border-radius: 10px; width: 100%; font-weight: bold; margin-top: 15px; }
        input, select { border: 1px solid #e2e8f0; padding: 12px; border-radius: 10px; width: 100%; margin-top: 8px; outline: none; background: white; }
        .state-card { background: #ea580c; color: white; padding: 15px; border-radius: 15px; text-align: center; font-weight: bold; cursor: pointer; font-size: 14px; }
        #adminLoginBtn { display: none; }
        .ad-container { background: #f1f5f9; border: 1px dashed #cbd5e1; text-align: center; font-size: 10px; color: #64748b; overflow: hidden; }
        .sticky-bottom-ad { position: fixed; bottom: 0; left: 0; right: 0; height: 60px; z-index: 100; background: white; border-top: 1px solid #e2e8f0; }
    </style>
</head>
<body class="max-w-md mx-auto min-h-screen bg-white shadow-2xl relative">

    <header class="flex items-center justify-between px-6 py-4 border-b bg-white sticky top-0 z-50">
        <div class="flex items-center gap-3">
            <div id="adminLogo" class="bg-orange-600 text-white w-10 h-10 flex items-center justify-center rounded-xl text-xl font-bold cursor-pointer select-none">G</div>
            <div>
                <h1 class="font-bold text-lg text-gray-800">Gram Shakti</h1>
                <p id="roleLabel" class="text-[10px] text-gray-400 font-bold uppercase">Select State</p>
            </div>
        </div>
        <button id="adminLoginBtn" onclick="loginPage()" class="text-[10px] font-bold text-orange-600 border border-orange-600 px-2 py-1 rounded">Admin Login</button>
    </header>

    <div id="topAdSlot" class="ad-container w-full h-24 flex items-center justify-center">
        <p>‡§Ø‡§π‡§æ‡§Å ‡§Ü‡§™‡§ï‡§æ ‡§¨‡•ú‡§æ ‡§µ‡§ø‡§ú‡•ç‡§û‡§æ‡§™‡§® (Banner) ‡§Ü‡§è‡§ó‡§æ</p>
    </div>

    <div id="app" class="p-5"></div>

    <div id="bottomAdSlot" class="sticky-bottom-ad flex items-center justify-center ad-container">
        <span>Google AdSense / Banner Space</span>
    </div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCuvev3-jwZwQu0_fHYyv2E2ovLny4LhRQ",
  authDomain: "gram-shakti-b135a.firebaseapp.com",
  projectId: "gram-shakti-b135a",
  storageBucket: "gram-shakti-b135a.firebasestorage.app",
  messagingSenderId: "340909973482",
  appId: "1:340909973482:web:c562cb3dd591b78de21c93",
  databaseURL: "https://gram-shakti-b135a-default-rtdb.firebaseio.com"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let selected = { state: "", district: "", panchayat: "", village: "" };
let currentUser = { role: "USER" };

// Master Admin Access (G hold 3s)
let timer;
const logo = document.getElementById("adminLogo");
const startTimer = () => {
    timer = setTimeout(() => {
        let pass = prompt("Master Password:");
        if(pass === "Vikas0627.") { 
            currentUser.role = "MAIN_ADMIN";
            document.getElementById("roleLabel").innerText = "MASTER CONTROL";
            document.getElementById("adminLoginBtn").style.display = "block";
            alert("Master Access Granted!");
            showStates();
        }
    }, 3000);
};
logo.addEventListener("mousedown", startTimer);
logo.addEventListener("mouseup", () => clearTimeout(timer));
logo.addEventListener("touchstart", startTimer);
logo.addEventListener("touchend", () => clearTimeout(timer));

function showStates() {
    const states = ['Uttar Pradesh', 'Bihar', 'Madhya Pradesh', 'Rajasthan', 'Gujarat', 'Punjab', 'Haryana', 'Maharashtra', 'West Bengal', 'Karnataka'];
    let html = `<h2 class="text-xl font-bold mb-4 text-center">‡§Ö‡§™‡§®‡§æ ‡§∞‡§æ‡§ú‡•ç‡§Ø ‡§ö‡•Å‡§®‡•á‡§Ç</h2><div class="grid grid-cols-2 gap-3">`;
    states.forEach(st => { html += `<div class="state-card" onclick="pickState('${st}')">${st}</div>`; });
    document.getElementById("app").innerHTML = html + `</div>`;
}

function pickState(s) { selected.state = s; showDistrictInp(); }
function showDistrictInp() { document.getElementById("app").innerHTML = `<h2>‡§ú‡§ø‡§≤‡§æ ‡§≤‡§ø‡§ñ‡•á‡§Ç</h2><input id="dist" placeholder="‡§ú‡§ø‡§≤‡§æ ‡§®‡§æ‡§Æ"><button onclick="pickDist()" class="btn-main">‡§Ü‡§ó‡•á ‡§¨‡•ù‡•á‡§Ç</button>`; }
function pickDist() { selected.district = document.getElementById("dist").value; showPanchayatInp(); }
function showPanchayatInp() { document.getElementById("app").innerHTML = `<h2>‡§™‡§Ç‡§ö‡§æ‡§Ø‡§§ ‡§≤‡§ø‡§ñ‡•á‡§Ç</h2><input id="panch" placeholder="‡§™‡§Ç‡§ö‡§æ‡§Ø‡§§ ‡§®‡§æ‡§Æ"><button onclick="selected.panchayat=document.getElementById('panch').value; showVillageInp()" class="btn-main">‡§Ü‡§ó‡•á ‡§¨‡•ù‡•á‡§Ç</button>`; }
function showVillageInp() { document.getElementById("app").innerHTML = `<h2>‡§ó‡§æ‡§Å‡§µ ‡§≤‡§ø‡§ñ‡•á‡§Ç</h2><input id="vill" placeholder="‡§ó‡§æ‡§Å‡§µ ‡§®‡§æ‡§Æ"><button onclick="selected.village=document.getElementById('vill').value; showOptions()" class="btn-main">‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç</button>`; }

function showOptions() {
    document.getElementById("app").innerHTML = `
        <div class="text-center py-4"><h2 class="text-2xl font-black">${selected.village}</h2><p class="text-gray-400 text-sm">${selected.district}</p></div>
        <button onclick="workerForm()" class="btn-main h-14">ü§ù ‡§Æ‡•à‡§Ç ‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§∏‡§æ‡§•‡•Ä ‡§π‡•Ç‡§Å</button>
        <button onclick="customerView()" class="btn-main bg-white border-2 border-orange-600 !text-orange-600 h-14">üîç ‡§∏‡•á‡§µ‡§æ ‡§¢‡•Ç‡§Å‡§¢‡•á‡§Ç</button>
    `;
}

function workerForm(){
  document.getElementById("app").innerHTML = `
    <h3 class="text-lg font-bold">‡§™‡§Ç‡§ú‡•Ä‡§ï‡§∞‡§£</h3>
    <input id="wname" placeholder="‡§Ü‡§™‡§ï‡§æ ‡§®‡§æ‡§Æ">
    <input id="wphone" type="tel" placeholder="‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞">
    <select id="work">
        <optgroup label="‡§≠‡§æ‡§∞‡•Ä ‡§Æ‡§∂‡•Ä‡§®‡§∞‡•Ä">
            <option value="JCB Operator">JCB ‡§ë‡§™‡§∞‡•á‡§ü‡§∞</option>
            <option value="Tractor Driver">‡§ü‡•ç‡§∞‡•à‡§ï‡•ç‡§ü‡§∞ ‡§°‡•ç‡§∞‡§æ‡§á‡§µ‡§∞</option>
            <option value="Combine Harvester">‡§π‡§æ‡§∞‡•ç‡§µ‡•á‡§∏‡•ç‡§ü‡§∞</option>
        </optgroup>
        <optgroup label="‡§Æ‡§ø‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä/‡§ï‡§æ‡§∞‡•Ä‡§ó‡§∞">
            <option value="Mistri (Construction)">‡§∞‡§æ‡§ú‡§Æ‡§ø‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä</option>
            <option value="Electrician">‡§¨‡§ø‡§ú‡§≤‡•Ä ‡§Æ‡§ø‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä</option>
            <option value="Plumber">‡§®‡§≤ ‡§Æ‡§ø‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä (‡§™‡•ç‡§≤‡§Æ‡•ç‡§¨‡§∞)</option>
            <option value="Carpenter">‡§¨‡•ù‡§à (‡§ï‡§æ‡§∞‡§™‡•á‡§Ç‡§ü‡§∞)</option>
            <option value="Tailor">‡§¶‡§∞‡•ç‡§ú‡•Ä</option>
        </optgroup>
        <optgroup label="‡§ñ‡•á‡§§‡•Ä & ‡§°‡•á‡§Ø‡§∞‡•Ä">
            <option value="Dairy/Milk">‡§¶‡•Ç‡§ß ‡§°‡•á‡§Ø‡§∞‡•Ä</option>
            <option value="Pashu Doctor">‡§™‡§∂‡•Å ‡§°‡•â‡§ï‡•ç‡§ü‡§∞ (VET)</option>
            <option value="Krishi Salahkar">‡§ï‡•É‡§∑‡§ø ‡§∏‡§≤‡§æ‡§π‡§ï‡§æ‡§∞</option>
        </optgroup>
        <optgroup label="‡§¶‡•Å‡§ï‡§æ‡§® & ‡§∏‡•á‡§µ‡§æ">
            <option value="Kirana Store">‡§ï‡§ø‡§∞‡§æ‡§®‡§æ ‡§¶‡•Å‡§ï‡§æ‡§®</option>
            <option value="Medical Store">‡§Æ‡•á‡§°‡§ø‡§ï‡§≤ ‡§∏‡•ç‡§ü‡•ã‡§∞</option>
            <option value="Tent House">‡§ü‡•á‡§Ç‡§ü ‡§π‡§æ‡§â‡§∏</option>
            <option value="DJ / Sound">DJ / ‡§∏‡§æ‡§â‡§Ç‡§° ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ</option>
            <option value="Photographer">‡§´‡•ã‡§ü‡•ã‡§ó‡•ç‡§∞‡§æ‡§´‡§∞</option>
        </optgroup>
        <optgroup label="‡§Ö‡§®‡•ç‡§Ø">
            <option value="Driver (Car/Auto)">‡§ï‡§æ‡§∞/‡§ë‡§ü‡•ã ‡§°‡•ç‡§∞‡§æ‡§á‡§µ‡§∞</option>
            <option value="Pandit ji">‡§™‡§Ç‡§°‡§ø‡§§ ‡§ú‡•Ä</option>
            <option value="Halwai">‡§π‡§≤‡§µ‡§æ‡§à</option>
            <option value="Labour">‡§Æ‡§ú‡§¶‡•Ç‡§∞</option>
        </optgroup>
    </select>
    <input id="villages" placeholder="‡§ï‡§æ‡§Æ ‡§ï‡•á ‡§ó‡§æ‡§Å‡§µ (‡§ó‡§æ‡§Å‡§µ1, ‡§ó‡§æ‡§Å‡§µ2)">
    <button onclick="saveWorker()" class="btn-main">‡§°‡•á‡§ü‡§æ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç</button>
  `;
}

function saveWorker(){
  let name = document.getElementById("wname").value;
  let phone = document.getElementById("wphone").value;
  let vInput = document.getElementById("villages").value;
  if(!name || !phone || !vInput) return alert("‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§™‡•Ç‡§∞‡•Ä ‡§≠‡§∞‡•á‡§Ç!");

  let id = Date.now();
  let vList = vInput.split(",");
  let vObj = {};
  vList.forEach(v => {
    let path = (selected.state+"/"+selected.district+"/"+selected.panchayat+"/"+v.trim()).replace(/\./g, '_');
    vObj[path] = true;
  });

  db.ref("workers/" + id).set({ name, work: document.getElementById("work").value, phone, villages: vObj })
  .then(() => { alert("‡§¨‡§ß‡§æ‡§à ‡§π‡•ã! ‡§Ü‡§™‡§ï‡§æ ‡§°‡•á‡§ü‡§æ ‡§∏‡•á‡§µ ‡§π‡•ã ‡§ó‡§Ø‡§æ‡•§"); showOptions(); });
}

function customerView() {
    document.getElementById("app").innerHTML = `<h3 class="font-bold mb-4">‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§∏‡§æ‡§•‡•Ä ‡§≤‡§ø‡§∏‡•ç‡§ü</h3><div id="list" class="space-y-3"></div>`;
    let currentPath = (selected.state+"/"+selected.district+"/"+selected.panchayat+"/"+selected.village).replace(/\./g, '_');
    db.ref("workers").once("value", snap => {
        let found = false;
        snap.forEach(w => {
            let data = w.val();
            if(JSON.stringify(data.villages).includes(currentPath)){
                found = true;
                document.getElementById("list").innerHTML += `
                <div class="p-3 border rounded-xl flex justify-between items-center bg-white">
                    <div><p class="font-bold">${data.name}</p><p class="text-orange-600 text-xs">${data.work}</p></div>
                    <a href="tel:${data.phone}" class="bg-green-600 text-white p-2 rounded-full">üìû</a>
                </div>`;
            }
        });
        if(!found) document.getElementById("list").innerHTML = "<p class='text-gray-400 text-center'>‡§á‡§∏ ‡§ó‡§æ‡§Å‡§µ ‡§Æ‡•á‡§Ç ‡§Ö‡§≠‡•Ä ‡§ï‡•ã‡§à ‡§∏‡§æ‡§•‡•Ä ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§</p>";
    });
}

function loginPage() { alert("Admin Login Coming Soon!"); }

showStates();
</script>
</body>
</html>
