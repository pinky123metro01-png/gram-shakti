<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gram Shakti | Complete & Perfect</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Hind:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Hind', sans-serif; background-color: #f8fafc; padding-bottom: 90px; }
        .btn-main { background: #ea580c; color: white; padding: 12px; border-radius: 10px; width: 100%; font-weight: bold; margin-top: 15px; cursor: pointer; border: none; }
        .btn-main:active { transform: scale(0.98); }
        input, select { border: 1px solid #e2e8f0; padding: 12px; border-radius: 10px; width: 100%; margin-top: 8px; outline: none; background: white; }
        .state-card { background: #ea580c; color: white; padding: 15px; border-radius: 12px; text-align: center; font-weight: bold; cursor: pointer; font-size: 14px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
        #adminLoginBtn { display: none; }
        .ad-container { background: #f1f5f9; border: 1px dashed #cbd5e1; text-align: center; font-size: 10px; color: #64748b; }
        .sticky-bottom-ad { position: fixed; bottom: 0; left: 0; right: 0; height: 60px; z-index: 100; background: white; border-top: 1px solid #e2e8f0; }
    </style>
</head>
<body class="max-w-md mx-auto min-h-screen bg-white shadow-2xl relative">

    <header class="flex items-center justify-between px-6 py-4 border-b bg-white sticky top-0 z-50">
        <div class="flex items-center gap-3">
            <div id="adminLogo" class="bg-orange-600 text-white w-10 h-10 flex items-center justify-center rounded-xl text-xl font-bold cursor-pointer select-none">G</div>
            <div>
                <h1 class="font-bold text-lg text-gray-800">Gram Shakti</h1>
                <p id="roleLabel" class="text-[10px] text-gray-400 font-bold uppercase">Bharat Ka App</p>
            </div>
        </div>
        <button id="adminLoginBtn" onclick="alert('Admin Panel: Coming Soon')" class="text-[10px] font-bold text-orange-600 border border-orange-600 px-2 py-1 rounded">Admin Login</button>
    </header>

    <div id="topAdSlot" class="ad-container w-full h-20 flex items-center justify-center">
        <span>‡§Ø‡§π‡§æ‡§Å ‡§Ö‡§™‡§®‡§æ ‡§™‡•ã‡§∏‡•ç‡§ü‡§∞ ‡§≤‡§ó‡§æ‡§Ø‡•á‡§Ç (Banner Ads)</span>
    </div>

    <div id="app" class="p-5"></div>

    <div id="bottomAdSlot" class="sticky-bottom-ad flex items-center justify-center ad-container">
        <span>Google AdSense / Banner Space</span>
    </div>

<script>
// --- Perfect Firebase Configuration ---
const firebaseConfig = {
  apiKey: "AIzaSyCuvev3-jwZwQu0_fHYyv2E2ovLny4LhRQ",
  authDomain: "gram-shakti-b135a.firebaseapp.com",
  projectId: "gram-shakti-b135a",
  storageBucket: "gram-shakti-b135a.firebasestorage.app",
  messagingSenderId: "340909973482",
  appId: "1:340909973482:web:c562cb3dd591b78de21c93",
  databaseURL: "https://gram-shakti-b135a-default-rtdb.firebaseio.com"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let selected = { state: "", district: "", panchayat: "", village: "" };

// --- Master Admin Logic (G hold for 3s) ---
let timer;
const logo = document.getElementById("adminLogo");
const startTimer = () => {
    timer = setTimeout(() => {
        let p = prompt("Master Password:");
        if(p === "Vikas0627.") { 
            document.getElementById("adminLoginBtn").style.display = "block";
            document.getElementById("roleLabel").innerText = "MASTER CONTROL";
            alert("Master Access Granted!");
        }
    }, 3000);
};
logo.addEventListener("mousedown", startTimer);
logo.addEventListener("mouseup", () => clearTimeout(timer));
logo.addEventListener("touchstart", startTimer);
logo.addEventListener("touchend", () => clearTimeout(timer));

// --- State Selection (Ab Saare Rajya) ---
function showStates() {
    const states = [
        'Andhra Pradesh', 'Arunachal Pradesh', 'Assam', 'Bihar', 'Chhattisgarh', 
        'Goa', 'Gujarat', 'Haryana', 'Himachal Pradesh', 'Jharkhand', 
        'Karnataka', 'Kerala', 'Madhya Pradesh', 'Maharashtra', 'Manipur', 
        'Meghalaya', 'Mizoram', 'Nagaland', 'Odisha', 'Punjab', 
        'Rajasthan', 'Sikkim', 'Tamil Nadu', 'Telangana', 'Tripura', 
        'Uttar Pradesh', 'Uttarakhand', 'West Bengal'
    ];
    let h = `<h2 class="text-xl font-bold mb-5 text-center">‡§Ö‡§™‡§®‡§æ ‡§∞‡§æ‡§ú‡•ç‡§Ø ‡§ö‡•Å‡§®‡•á‡§Ç</h2><div class="grid grid-cols-2 gap-3">`;
    states.forEach(s => { h += `<div class="state-card" onclick="selected.state='${s}'; showDistrictInp()">${s}</div>`; });
    document.getElementById("app").innerHTML = h + `</div>`;
}

// --- Navigation Steps ---
function showDistrictInp() { document.getElementById("app").innerHTML = `<h2 class='font-bold'>‡§Ö‡§™‡§®‡§æ ‡§ú‡§ø‡§≤‡§æ ‡§≤‡§ø‡§ñ‡•á‡§Ç</h2><input id="dist" placeholder="‡§ú‡§ø‡§≤‡§æ ‡§®‡§æ‡§Æ..."><button onclick="selected.district=document.getElementById('dist').value; showPanchayatInp()" class="btn-main">‡§Ü‡§ó‡•á ‡§¨‡•ù‡•á‡§Ç</button>`; }
function showPanchayatInp() { document.getElementById("app").innerHTML = `<h2 class='font-bold'>‡§Ö‡§™‡§®‡•Ä ‡§™‡§Ç‡§ö‡§æ‡§Ø‡§§ ‡§≤‡§ø‡§ñ‡•á‡§Ç</h2><input id="panch" placeholder="‡§™‡§Ç‡§ö‡§æ‡§Ø‡§§ ‡§®‡§æ‡§Æ..."><button onclick="selected.panchayat=document.getElementById('panch').value; showVillageInp()" class="btn-main">‡§Ü‡§ó‡•á ‡§¨‡•ù‡•á‡§Ç</button>`; }
function showVillageInp() { document.getElementById("app").innerHTML = `<h2 class='font-bold'>‡§Ö‡§™‡§®‡§æ ‡§ó‡§æ‡§Å‡§µ ‡§≤‡§ø‡§ñ‡•á‡§Ç</h2><input id="vill" placeholder="‡§ó‡§æ‡§Å‡§µ ‡§®‡§æ‡§Æ..."><button onclick="selected.village=document.getElementById('vill').value; showOptions()" class="btn-main">‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç</button>`; }

function showOptions() {
    document.getElementById("app").innerHTML = `
        <div class="text-center py-6">
            <h2 class="text-3xl font-black text-orange-600">${selected.village}</h2>
            <p class="text-gray-400 text-sm">${selected.district}, ${selected.state}</p>
        </div>
        <button onclick="workerForm()" class="btn-main h-16 text-lg">ü§ù ‡§Æ‡•à‡§Ç ‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§∏‡§æ‡§•‡•Ä ‡§π‡•Ç‡§Å</button>
        <button onclick="customerView()" class="btn-main bg-white border-2 border-orange-600 !text-orange-600 h-16 text-lg mt-4">üîç ‡§∏‡•á‡§µ‡§æ ‡§¢‡•Ç‡§Å‡§¢‡•á‡§Ç</button>
        <button onclick="showStates()" class="w-full text-xs text-gray-400 mt-10 underline">‡§∞‡§æ‡§ú‡•ç‡§Ø ‡§¨‡§¶‡§≤‡•á‡§Ç</button>
    `;
}

// --- Full Category List ---
function workerForm(){
  document.getElementById("app").innerHTML = `
    <h3 class="text-xl font-bold mb-4 text-center text-gray-800">‡§™‡§Ç‡§ú‡•Ä‡§ï‡§∞‡§£ ‡§´‡•â‡§∞‡•ç‡§Æ</h3>
    <label class="text-sm font-bold text-gray-600">‡§Ü‡§™‡§ï‡§æ ‡§®‡§æ‡§Æ</label>
    <input id="wname" placeholder="‡§®‡§æ‡§Æ ‡§≤‡§ø‡§ñ‡•á‡§Ç">
    <label class="text-sm font-bold text-gray-600">‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞</label>
    <input id="wphone" type="tel" placeholder="00000 00000">
    <label class="text-sm font-bold text-gray-600">‡§Ü‡§™‡§ï‡§æ ‡§ï‡§æ‡§Æ (‡§∂‡•ç‡§∞‡•á‡§£‡•Ä)</label>
    <select id="work">
        <optgroup label="‡§≠‡§æ‡§∞‡•Ä ‡§Æ‡§∂‡•Ä‡§®‡§∞‡•Ä">
            <option value="JCB Operator">JCB ‡§ë‡§™‡§∞‡•á‡§ü‡§∞</option>
            <option value="Tractor Driver">‡§ü‡•ç‡§∞‡•à‡§ï‡•ç‡§ü‡§∞ ‡§°‡•ç‡§∞‡§æ‡§á‡§µ‡§∞</option>
            <option value="Combine Harvester">‡§π‡§æ‡§∞‡•ç‡§µ‡•á‡§∏‡•ç‡§ü‡§∞</option>
        </optgroup>
        <optgroup label="‡§Æ‡§ø‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä/‡§ï‡§æ‡§∞‡•Ä‡§ó‡§∞">
            <option value="Mistri">‡§∞‡§æ‡§ú‡§Æ‡§ø‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä</option>
            <option value="Electrician">‡§¨‡§ø‡§ú‡§≤‡•Ä ‡§Æ‡§ø‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä</option>
            <option value="Plumber">‡§®‡§≤ ‡§Æ‡§ø‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä</option>
            <option value="Carpenter">‡§¨‡•ù‡§à</option>
            <option value="Tailor">‡§¶‡§∞‡•ç‡§ú‡•Ä</option>
            <option value="Painter">‡§™‡•á‡§Ç‡§ü‡§∞</option>
        </optgroup>
        <optgroup label="‡§¶‡•Å‡§ï‡§æ‡§® & ‡§∏‡•á‡§µ‡§æ">
            <option value="Kirana Store">‡§ï‡§ø‡§∞‡§æ‡§®‡§æ ‡§¶‡•Å‡§ï‡§æ‡§®</option>
            <option value="Milk Dairy">‡§¶‡•Ç‡§ß ‡§°‡•á‡§Ø‡§∞‡•Ä</option>
            <option value="Medical Store">‡§Æ‡•á‡§°‡§ø‡§ï‡§≤ ‡§∏‡•ç‡§ü‡•ã‡§∞</option>
            <option value="Tent House">‡§ü‡•á‡§Ç‡§ü ‡§π‡§æ‡§â‡§∏</option>
            <option value="DJ/Sound">DJ/‡§∏‡§æ‡§â‡§Ç‡§°</option>
            <option value="Driver">‡§ï‡§æ‡§∞/‡§ë‡§ü‡•ã ‡§°‡•ç‡§∞‡§æ‡§á‡§µ‡§∞</option>
        </optgroup>
        <optgroup label="‡§Ö‡§®‡•ç‡§Ø">
            <option value="Pandit ji">‡§™‡§Ç‡§°‡§ø‡§§ ‡§ú‡•Ä</option>
            <option value="Halwai">‡§π‡§≤‡§µ‡§æ‡§à</option>
            <option value="Labour">‡§Æ‡§ú‡§¶‡•Ç‡§∞</option>
        </optgroup>
    </select>
    <label class="text-sm font-bold text-gray-600">‡§ï‡§æ‡§Æ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§ó‡§æ‡§Å‡§µ (‡§ï‡•ã‡§Æ‡§æ , ‡§≤‡§ó‡§æ‡§Ø‡•á‡§Ç)</label>
    <input id="villages" placeholder="‡§ó‡§æ‡§Å‡§µ1, ‡§ó‡§æ‡§Å‡§µ2, ‡§ó‡§æ‡§Å‡§µ3">
    <button onclick="saveWorker()" id="saveBtn" class="btn-main">‡§°‡•á‡§ü‡§æ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç</button>
    <button onclick="showOptions()" class="w-full text-sm text-gray-400 mt-4">‡§∞‡§¶‡•ç‡§¶ ‡§ï‡§∞‡•á‡§Ç</button>
  `;
}

// --- Perfect Save Logic ---
function saveWorker(){
  let name = document.getElementById("wname").value;
  let phone = document.getElementById("wphone").value;
  let work = document.getElementById("work").value;
  let vInput = document.getElementById("villages").value;
  let btn = document.getElementById("saveBtn");

  if(!name || !phone || !vInput) return alert("‡§≠‡§æ‡§à, ‡§™‡•Ç‡§∞‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§§‡•ã ‡§≠‡§∞‡•ã!");

  btn.innerText = "‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...";
  btn.disabled = true;

  let id = Date.now();
  let vList = vInput.split(",");
  let vObj = {};
  vList.forEach(v => {
    let path = (selected.state+"/"+selected.district+"/"+selected.panchayat+"/"+v.trim()).replace(/\./g, '_');
    vObj[path] = true;
  });

  db.ref("workers/" + id).set({
    name: name,
    work: work,
    phone: phone,
    villages: vObj
  }).then(() => {
    alert("‡§¨‡§ß‡§æ‡§à ‡§π‡•ã ‡§∞‡§µ‡§ø ‡§≠‡§æ‡§à! ‡§°‡•á‡§ü‡§æ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§π‡•ã ‡§ó‡§Ø‡§æ‡•§");
    showOptions(); // Goes back to Home
  }).catch((e) => {
    alert("‡§ó‡•ú‡§¨‡•ú: " + e.message);
    btn.disabled = false;
    btn.innerText = "‡§°‡•á‡§ü‡§æ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç";
  });
}

// --- Customer List View ---
function customerView() {
    document.getElementById("app").innerHTML = `<h3 class="font-bold mb-4 text-center">‡§Ü‡§™‡§ï‡•á ‡§ó‡§æ‡§Å‡§µ ‡§ï‡•á ‡§∏‡§æ‡§•‡•Ä</h3><div id="list" class="space-y-3"></div><button onclick="showOptions()" class="w-full text-xs text-gray-400 mt-8 underline">‡§™‡•Ä‡§õ‡•á ‡§ú‡§æ‡§è‡§Å</button>`;
    let currentPath = (selected.state+"/"+selected.district+"/"+selected.panchayat+"/"+selected.village).replace(/\./g, '_');
    
    db.ref("workers").once("value", snap => {
        let found = false;
        snap.forEach(w => {
            let data = w.val();
            if(JSON.stringify(data.villages).includes(currentPath)){
                found = true;
                document.getElementById("list").innerHTML += `
                <div class="p-4 border rounded-xl flex justify-between items-center bg-white shadow-sm border-l-4 border-l-orange-500">
                    <div><p class="font-bold text-gray-800">${data.name}</p><p class="text-orange-600 text-xs font-bold uppercase">${data.work}</p></div>
                    <a href="tel:${data.phone}" class="bg-green-600 text-white p-3 rounded-full shadow-lg">üìû</a>
                </div>`;
            }
        });
        if(!found) document.getElementById("list").innerHTML = "<div class='text-center py-10'><p class='text-gray-400'>‡§Ö‡§≠‡•Ä ‡§á‡§∏ ‡§ó‡§æ‡§Å‡§µ ‡§Æ‡•á‡§Ç ‡§ï‡•ã‡§à ‡§∏‡§æ‡§•‡•Ä ‡§®‡§π‡•Ä‡§Ç ‡§ú‡•Å‡•ú‡§æ ‡§π‡•à‡•§</p></div>";
    });
}

// Start the App
showStates();
</script>
</body>
</html>
