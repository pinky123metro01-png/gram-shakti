<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gram Shakti | Complete Master System</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<style>
  body { background: linear-gradient(135deg,#ffedd5,#fde68a,#bbf7d0); font-family: sans-serif; min-height: 100vh; }
  .input-field { width: 100%; padding: 14px; border-radius: 12px; border: 1px solid #ddd; margin-top: 10px; outline: none; }
  .btn-orange { width: 100%; padding: 16px; background: linear-gradient(90deg,#ea580c,#f97316); color: white; border-radius: 14px; font-weight: bold; margin-top: 20px; }
  .state-card { background: #ea580c; color: white; padding: 15px; border-radius: 12px; text-align: center; font-weight: bold; cursor: pointer; font-size: 14px; }
  .bad-alert { background: #fee2e2; border: 2px solid #ef4444; color: #b91c1c; animation: flash 1s infinite; }
  @keyframes flash { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
</style>
</head>
<body class="p-4 flex flex-col items-center">

<div id="app-container" class="bg-white w-full max-w-md p-6 rounded-3xl shadow-2xl relative mt-4 min-h-[550px]">
  </div>

<script>
/* üî• Firebase Setup */
const firebaseConfig = {
  apiKey: "AIzaSyCuvev3-jwZwQu0_fHYyv2E2ovLny4LhRQ",
  authDomain: "gram-shakti-b135a.firebaseapp.com",
  databaseURL: "https://gram-shakti-b135a-default-rtdb.firebaseio.com",
  projectId: "gram-shakti-b135a"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let userFlow = { state: "", district: "", panchayat: "", village: "" };
const badWords = ["‡§ó‡§æ‡§≤‡•Ä", "sala", "haram", "pagal", "bad"]; // ‡§Ø‡§π‡§æ‡§Å ‡§î‡§∞ ‡§∂‡§¨‡•ç‡§¶ ‡§ú‡•ã‡•ú ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç

// --- 1. ‡§∞‡§æ‡§ú‡•ç‡§Ø ‡§ö‡§Ø‡§® ---
function showStates() {
  const states = ['Bihar', 'Uttar Pradesh', 'Rajasthan', 'Madhya Pradesh', 'Haryana', 'Gujarat', 'Maharashtra', 'Punjab', 'Jharkhand', 'Uttarakhand'];
  let html = `<div class="flex justify-between items-center mb-6">
                <div id="adminLogo" class="bg-orange-600 text-white w-10 h-10 flex items-center justify-center rounded-xl font-bold cursor-pointer select-none">G</div>
                <h2 class="text-xl font-black text-orange-600">‡§∞‡§æ‡§ú‡•ç‡§Ø ‡§ö‡•Å‡§®‡•á‡§Ç</h2>
                <div class="w-10"></div>
              </div>
              <div class="grid grid-cols-2 gap-3 h-[380px] overflow-y-auto pr-2">`;
  states.forEach(s => { html += `<div class="state-card shadow-md" onclick="userFlow.state='${s}'; showDistrictStep()">${s}</div>`; });
  document.getElementById("app-container").innerHTML = html + `</div>`;
  setupAdminHold();
}

// --- 2. ‡§ú‡§ø‡§≤‡§æ ---
function showDistrictStep() {
  document.getElementById("app-container").innerHTML = `
    <h2 class="text-xl font-bold text-gray-700">‡§ú‡§ø‡§≤‡§æ ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§≤‡§ø‡§ñ‡•á‡§Ç</h2>
    <input id="distInp" class="input-field" placeholder="‡§ú‡§ø‡§≤‡§æ...">
    <button onclick="userFlow.district=document.getElementById('distInp').value; showPanchayatStep()" class="btn-orange">‡§Ü‡§ó‡•á ‡§¨‡•ù‡•á‡§Ç</button>
  `;
}

// --- 3. ‡§™‡§Ç‡§ö‡§æ‡§Ø‡§§ (‡§ú‡•ã ‡§Æ‡§ø‡§∏ ‡§π‡•ã ‡§ó‡§à ‡§•‡•Ä) ---
function showPanchayatStep() {
  document.getElementById("app-container").innerHTML = `
    <h2 class="text-xl font-bold text-gray-700">‡§™‡§Ç‡§ö‡§æ‡§Ø‡§§ ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§≤‡§ø‡§ñ‡•á‡§Ç</h2>
    <input id="panchInp" class="input-field" placeholder="‡§™‡§Ç‡§ö‡§æ‡§Ø‡§§...">
    <button onclick="userFlow.panchayat=document.getElementById('panchInp').value; showVillageStep()" class="btn-orange">‡§Ü‡§ó‡•á ‡§¨‡•ù‡•á‡§Ç</button>
  `;
}

// --- 4. ‡§ó‡§æ‡§Å‡§µ ---
function showVillageStep() {
  document.getElementById("app-container").innerHTML = `
    <h2 class="text-xl font-bold text-gray-700">‡§ó‡§æ‡§Å‡§µ ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§≤‡§ø‡§ñ‡•á‡§Ç</h2>
    <input id="villInp" class="input-field" placeholder="‡§ó‡§æ‡§Å‡§µ...">
    <button onclick="userFlow.village=document.getElementById('villInp').value; showRegistration()" class="btn-orange">‡§´‡•â‡§∞‡•ç‡§Æ ‡§ñ‡•ã‡§≤‡•á‡§Ç</button>
  `;
}

// --- 5. ‡§™‡§Ç‡§ú‡•Ä‡§ï‡§∞‡§£ (‡§∏‡•Å‡§à ‡§∏‡•á JCB ‡§§‡§ï) ---
function showRegistration() {
  document.getElementById("app-container").innerHTML = `
    <h2 class="text-2xl font-black text-orange-600 text-center">üåæ ‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§∂‡§ï‡•ç‡§§‡§ø</h2>
    <p class="text-center text-gray-400 text-[10px] mb-4 uppercase font-bold">${userFlow.village} | ${userFlow.panchayat}</p>
    
    <input id="wname" class="input-field" placeholder="‡§™‡•Ç‡§∞‡§æ ‡§®‡§æ‡§Æ">
    <input id="wphone" class="input-field" placeholder="‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞" type="tel">
    
    <select id="wwork" class="input-field">
      <option value="">‡§ï‡§æ‡§Æ ‡§ö‡•Å‡§®‡•á‡§Ç (‡§∏‡•Å‡§à ‡§∏‡•á JCB ‡§§‡§ï)</option>
      <optgroup label="‡§≠‡§æ‡§∞‡•Ä ‡§Æ‡§∂‡•Ä‡§®‡§∞‡•Ä">
        <option>JCB Operator</option><option>Tractor Driver</option><option>Harvester</option>
      </optgroup>
      <optgroup label="‡§Æ‡§ø‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä & ‡§ï‡§æ‡§∞‡•Ä‡§ó‡§∞">
        <option>‡§∞‡§æ‡§ú‡§Æ‡§ø‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä (Mistri)</option><option>Electrician</option><option>Plumber</option><option>Carpenter</option><option>Painter</option><option>Tailor (‡§¶‡§∞‡•ç‡§ú‡•Ä)</option>
      </optgroup>
      <optgroup label="‡§¶‡•Å‡§ï‡§æ‡§® & ‡§∏‡•á‡§µ‡§æ">
        <option>‡§ï‡§ø‡§∞‡§æ‡§®‡§æ ‡§¶‡•Å‡§ï‡§æ‡§®</option><option>‡§¶‡•Ç‡§ß ‡§°‡•á‡§Ø‡§∞‡•Ä</option><option>‡§Æ‡•á‡§°‡§ø‡§ï‡§≤ ‡§∏‡•ç‡§ü‡•ã‡§∞</option><option>Tent House</option><option>DJ Sound</option>
      </optgroup>
      <optgroup label="‡§õ‡•ã‡§ü‡•Ä ‡§∏‡•á‡§µ‡§æ‡§è‡§Ç">
        <option>‡§Æ‡§ú‡§¶‡•Ç‡§∞ (Labour)</option><option>‡§®‡§æ‡§à (Barber)</option><option>‡§™‡§Ç‡§°‡§ø‡§§ ‡§ú‡•Ä</option><option>‡§π‡§≤‡§µ‡§æ‡§à</option>
      </optgroup>
    </select>
    
    <button onclick="saveWorker()" class="btn-orange">‡§°‡•á‡§ü‡§æ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç</button>
  `;
}

function saveWorker() {
  const n = document.getElementById("wname").value.trim();
  const p = document.getElementById("wphone").value.trim();
  const w = document.getElementById("wwork").value;
  if(!n || !p || !w) return alert("‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•Ç‡§∞‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§≠‡§∞‡•á‡§Ç!");

  db.ref("workers").push({
    name: n, phone: p, work: w,
    location: `${userFlow.state}/${userFlow.district}/${userFlow.panchayat}/${userFlow.village}`,
    rating: 5,
    comments: [{ text: "‡§™‡§Ç‡§ú‡•Ä‡§ï‡§∞‡§£ ‡§∏‡§´‡§≤", user: "Admin", time: Date.now() }],
    time: Date.now()
  }).then(() => { alert("‡§¨‡§ß‡§æ‡§à ‡§π‡•ã! ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§π‡•ã ‡§ó‡§Ø‡§æ‡•§"); location.reload(); });
}

// --- 6. ‡§Æ‡§æ‡§∏‡•ç‡§ü‡§∞ ‡§è‡§°‡§Æ‡§ø‡§® (3 ‡§∏‡•á‡§ï‡§Ç‡§° ‡§π‡•ã‡§≤‡•ç‡§°) ---
function setupAdminHold() {
  const logo = document.getElementById("adminLogo");
  let timer;
  logo.onmousedown = () => { timer = setTimeout(() => {
    let p = prompt("Master Password:");
    if(p === "Vikas0627.") showAdminPanel();
  }, 3000); };
  logo.onmouseup = () => clearTimeout(timer);
}

function showAdminPanel() {
  document.getElementById("app-container").innerHTML = `
    <div class="flex justify-between items-center mb-4 border-b pb-2">
      <h2 class="text-xl font-bold text-red-600">Master Control</h2>
      <button onclick="location.reload()" class="text-xs bg-gray-100 px-2 py-1 rounded">Logout</button>
    </div>
    <div id="adminList" class="space-y-3 max-h-[480px] overflow-y-auto">‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</div>
  `;

  db.ref("workers").on("value", (snap) => {
    let html = "";
    snap.forEach(child => {
      const data = child.val();
      let hasBadWord = false;
      if(data.comments) {
        hasBadWord = data.comments.some(c => badWords.some(w => c.text.toLowerCase().includes(w)));
      }

      html += `
        <div class="p-3 border rounded-xl shadow-sm ${hasBadWord ? 'bad-alert' : 'bg-gray-50'}">
          <div class="flex justify-between items-start">
            <div>
              <p class="font-bold text-sm">${data.name} (${data.work})</p>
              <p class="text-[10px] text-gray-500">${data.location}</p>
              <p class="text-blue-600 font-bold text-xs">${data.phone}</p>
            </div>
            <button onclick="deleteEntry('${child.key}')" class="bg-red-600 text-white text-[10px] px-2 py-1 rounded">Delete</button>
          </div>
          ${hasBadWord ? '<p class="text-[10px] font-black mt-1">‚ö†Ô∏è ‡§ö‡•á‡§§‡§æ‡§µ‡§®‡•Ä: ‡§ó‡§≤‡§§ ‡§ï‡§Æ‡•á‡§Ç‡§ü ‡§™‡§æ‡§Ø‡§æ ‡§ó‡§Ø‡§æ!</p>' : ''}
        </div>`;
    });
    document.getElementById("adminList").innerHTML = html || "‡§ï‡•ã‡§à ‡§°‡•á‡§ü‡§æ ‡§®‡§π‡•Ä‡§Ç";
  });
}

function deleteEntry(id) {
  if(confirm("‡§∞‡§µ‡§ø ‡§≠‡§æ‡§à, ‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§á‡§∏ ‡§µ‡§∞‡•ç‡§ï‡§∞ ‡§ï‡•ã ‡§°‡§ø‡§≤‡•Ä‡§ü ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?")) {
    db.ref("workers/" + id).remove();
  }
}

showStates();
</script>
</body>
</html>
