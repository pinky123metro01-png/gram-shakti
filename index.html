<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gram Shakti | Admin & Registration</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<style>
  body { background: linear-gradient(135deg,#ffedd5,#fde68a,#bbf7d0); font-family: sans-serif; min-height: 100-vh; }
  .input-field { width: 100%; padding: 14px; border-radius: 12px; border: 1px solid #ddd; margin-top: 10px; outline: none; }
  .btn-orange { width: 100%; padding: 16px; background: linear-gradient(90deg,#ea580c,#f97316); color: white; border-radius: 14px; font-weight: bold; margin-top: 20px; }
  .state-card { background: #ea580c; color: white; padding: 15px; border-radius: 12px; text-align: center; font-weight: bold; cursor: pointer; }
  .admin-card { background: white; padding: 10px; border-radius: 10px; margin-bottom: 10px; border-left: 5px solid #ea580c; }
</style>
</head>
<body class="p-4 flex flex-col items-center">

<div id="app-container" class="bg-white w-full max-w-md p-6 rounded-3xl shadow-2xl relative">
  </div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCuvev3-jwZwQu0_fHYyv2E2ovLny4LhRQ",
  authDomain: "gram-shakti-b135a.firebaseapp.com",
  databaseURL: "https://gram-shakti-b135a-default-rtdb.firebaseio.com",
  projectId: "gram-shakti-b135a"
};
firebase.initializeApp(firebaseConfig);
const database = firebase.database();

let userData = { state: "", district: "", panchayat: "", village: "" };

// --- LOGO HOLD FOR ADMIN ---
function addAdminTrigger() {
  const logo = document.getElementById("adminLogo");
  let timer;
  logo.addEventListener("mousedown", () => {
    timer = setTimeout(() => {
      let p = prompt("Master Password:");
      if(p === "Vikas0627.") showAdminPanel();
    }, 3000);
  });
  logo.addEventListener("mouseup", () => clearTimeout(timer));
}

// 1. STATE STEP
function showStateStep() {
  const states = ['Uttar Pradesh', 'Bihar', 'Rajasthan', 'Madhya Pradesh', 'Haryana', 'Gujarat'];
  let html = `<div class="flex justify-between items-center mb-6">
                <div id="adminLogo" class="bg-orange-600 text-white w-10 h-10 flex items-center justify-center rounded-xl font-bold cursor-pointer">G</div>
                <h2 class="text-xl font-black text-orange-600">‡§∞‡§æ‡§ú‡•ç‡§Ø ‡§ö‡•Å‡§®‡•á‡§Ç</h2>
                <div class="w-10"></div>
              </div>
              <div class="grid grid-cols-2 gap-3">`;
  states.forEach(s => { html += `<div class="state-card" onclick="selectState('${s}')">${s}</div>`; });
  document.getElementById("app-container").innerHTML = html + `</div>`;
  addAdminTrigger();
}

function selectState(s) { userData.state = s; showDistrictStep(); }

function showDistrictStep() {
  document.getElementById("app-container").innerHTML = `
    <h2 class="text-xl font-bold">‡§ú‡§ø‡§≤‡§æ ‡§≤‡§ø‡§ñ‡•á‡§Ç</h2>
    <input id="distInp" class="input-field" placeholder="‡§ú‡§ø‡§≤‡§æ...">
    <button onclick="userData.district=document.getElementById('distInp').value; showVillageStep()" class="btn-orange">‡§Ü‡§ó‡•á ‡§¨‡•ù‡•á‡§Ç</button>
  `;
}

function showVillageStep() {
  document.getElementById("app-container").innerHTML = `
    <h2 class="text-xl font-bold">‡§ó‡§æ‡§Å‡§µ ‡§≤‡§ø‡§ñ‡•á‡§Ç</h2>
    <input id="villInp" class="input-field" placeholder="‡§ó‡§æ‡§Å‡§µ...">
    <button onclick="userData.village=document.getElementById('villInp').value; showForm()" class="btn-orange">‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç</button>
  `;
}

function showForm() {
  document.getElementById("app-container").innerHTML = `
    <h2 class="text-2xl font-black text-orange-600">üåæ ‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§∂‡§ï‡•ç‡§§‡§ø</h2>
    <p class="text-gray-400 text-xs mb-4 uppercase font-bold">${userData.village} | ${userData.district}</p>
    <input id="wname" class="input-field" placeholder="‡§®‡§æ‡§Æ">
    <input id="wphone" class="input-field" placeholder="‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤">
    <select id="wwork" class="input-field">
      <option>JCB Operator</option><option>Driver</option><option>Mistri</option><option>Dairy</option>
    </select>
    <button onclick="finalSave()" id="sBtn" class="btn-orange">‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç</button>
  `;
}

function finalSave() {
  const n = document.getElementById("wname").value;
  const p = document.getElementById("wphone").value;
  const w = document.getElementById("wwork").value;
  if(!n || !p) return alert("‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§≠‡§∞‡•á‡§Ç");
  
  database.ref("workers").push({
    name: n, phone: p, work: w, 
    loc: `${userData.state}/${userData.district}/${userData.village}`,
    time: Date.now()
  }).then(() => { alert("‡§∏‡§´‡§≤!"); location.reload(); });
}

// --- ADMIN PANEL VIEW ---
function showAdminPanel() {
  document.getElementById("app-container").innerHTML = `
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-xl font-bold text-red-600">Admin Panel</h2>
      <button onclick="location.reload()" class="text-xs bg-gray-200 px-2 py-1 rounded">Logout</button>
    </div>
    <div id="adminList" class="max-h-[400px] overflow-y-auto">‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</div>
  `;
  
  database.ref("workers").on("value", (snap) => {
    let html = "";
    snap.forEach(child => {
      let d = child.val();
      html += `
        <div class="admin-card text-sm">
          <p><b>${d.name}</b> (${d.work})</p>
          <p>${d.phone} | ${d.loc}</p>
          <button onclick="deleteWorker('${child.key}')" class="text-red-500 text-xs font-bold mt-1">‡§°‡§ø‡§≤‡•Ä‡§ü ‡§ï‡§∞‡•á‡§Ç</button>
        </div>`;
    });
    document.getElementById("adminList").innerHTML = html || "‡§ï‡•ã‡§à ‡§°‡•á‡§ü‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à";
  });
}

function deleteWorker(id) {
  if(confirm("‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§á‡§∏ ‡§µ‡§∞‡•ç‡§ï‡§∞ ‡§ï‡•ã ‡§π‡§ü‡§æ‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?")) {
    database.ref("workers/" + id).remove();
  }
}

showStateStep();
</script>
</body>
</html>
