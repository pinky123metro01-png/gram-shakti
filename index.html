<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gram Shakti | Complete & Fixed</title>

<script src="https://cdn.tailwindcss.com"></script>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<style>
  body {
    background: linear-gradient(135deg,#ffedd5,#fde68a,#bbf7d0);
    font-family: 'Hind', sans-serif;
  }
  .input-field {
    width: 100%;
    padding: 14px;
    border-radius: 12px;
    border: 1px solid #ddd;
    margin-top: 12px;
    outline: none;
  }
  .input-field:focus {
    border-color: #ea580c;
    ring: 2px;
    ring-color: #ffedd5;
  }
  .btn-orange {
    width: 100%;
    padding: 16px;
    background: linear-gradient(90deg,#ea580c,#f97316);
    color: white;
    border-radius: 14px;
    font-size: 18px;
    font-weight: bold;
    margin-top: 20px;
    transition: all 0.3s;
  }
  .btn-orange:active { transform: scale(0.95); }
  .btn-orange:disabled { background: #9ca3af; cursor: not-allowed; }
</style>
</head>

<body class="min-h-screen flex items-center justify-center p-4">

<div id="mainForm" class="bg-white w-full max-w-md p-6 rounded-3xl shadow-2xl">
  <h2 class="text-center text-3xl font-extrabold text-orange-600">ЁЯМ╛ рдЧреНрд░рд╛рдо рд╢рдХреНрддрд┐</h2>
  <p class="text-center text-gray-500 mt-1 font-medium">рдкрдВрдЬреАрдХрд░рдг рдлреЙрд░реНрдо</p>

  <div class="mt-4">
    <label class="text-xs font-bold text-gray-400 uppercase ml-1">рдЖрдкрдХрд╛ рдирд╛рдо</label>
    <input id="wname" class="input-field" placeholder="рдирд╛рдо рд▓рд┐рдЦреЗрдВ">
    
    <label class="text-xs font-bold text-gray-400 uppercase ml-1 mt-3 block">рдореЛрдмрд╛рдЗрд▓ рдирдВрдмрд░</label>
    <input id="wphone" class="input-field" placeholder="00000 00000" type="tel">

    <label class="text-xs font-bold text-gray-400 uppercase ml-1 mt-3 block">рдХрд╛рдо рдХрд╛ рдкреНрд░рдХрд╛рд░</label>
    <select id="workCategory" class="input-field">
      <option value="">рдХрд╛рдо рдЪреБрдиреЗрдВ</option>
      <option value="JCB Operator">JCB рдСрдкрд░реЗрдЯрд░</option>
      <option value="Driver">рдбреНрд░рд╛рдЗрд╡рд░</option>
      <option value="Mistri">рдорд┐рд╕реНрддреНрд░реА</option>
      <option value="Dairy">рдбреЗрдпрд░реА / рджреВрдз</option>
      <option value="Dukaan">рдХрд┐рд░рд╛рдирд╛ рджреБрдХрд╛рди</option>
    </select>

    <label class="text-xs font-bold text-gray-400 uppercase ml-1 mt-3 block">рдЧрд╛рдБрд╡ рдХрд╛ рдирд╛рдо</label>
    <input id="villages" class="input-field" placeholder="рдЧрд╛рдБрд╡ рдХрд╛ рдирд╛рдо рд▓рд┐рдЦреЗрдВ">

    <button id="saveBtn" class="btn-orange" onclick="saveToFirebase()">
      рдбреЗрдЯрд╛ рд╕реБрд░рдХреНрд╖рд┐рдд рдХрд░реЗрдВ
    </button>
    
    <p id="statusMsg" class="text-center mt-4 text-sm font-bold"></p>
  </div>
</div>

<div id="successBox" class="hidden fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4">
  <div class="bg-white p-8 rounded-3xl text-center w-full max-w-xs shadow-2xl scale-110 transition-all">
    <div class="w-20 h-20 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-4 text-4xl">
      тЬЕ
    </div>
    <h3 class="text-green-600 text-2xl font-bold">рд╕рдлрд▓ рдкрдВрдЬреАрдХрд░рдг</h3>
    <p class="mt-2 text-gray-600 font-medium">
      рд░рд╡рд┐ рднрд╛рдИ, рдЖрдкрдХрд╛ рдбреЗрдЯрд╛ рд╕реБрд░рдХреНрд╖рд┐рдд рдХрд░ рд▓рд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред
    </p>
    <button onclick="closeSuccess()" class="mt-6 bg-green-600 hover:bg-green-700 text-white w-full py-3 rounded-xl font-bold text-lg shadow-lg">
      рдареАрдХ рд╣реИ (OK)
    </button>
  </div>
</div>

<div id="errorBox" class="hidden fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4">
  <div class="bg-white p-8 rounded-3xl text-center w-full max-w-xs shadow-2xl border-t-4 border-red-600">
    <h3 class="text-red-600 text-2xl font-bold">тЭМ рдЧреЬрдмреЬ рд╣реБрдИ</h3>
    <p id="errorMsg" class="mt-2 text-gray-600"></p>
    <button onclick="closeError()" class="mt-6 bg-red-600 text-white w-full py-3 rounded-xl font-bold shadow-lg">
      рдлрд┐рд░ рд╕реЗ рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВ
    </button>
  </div>
</div>

<script>
/* ЁЯФе Firebase Configuration */
const firebaseConfig = {
  apiKey: "AIzaSyCuvev3-jwZwQu0_fHYyv2E2ovLny4LhRQ",
  authDomain: "gram-shakti-b135a.firebaseapp.com",
  databaseURL: "https://gram-shakti-b135a-default-rtdb.firebaseio.com",
  projectId: "gram-shakti-b135a"
};

// Initialize Firebase safely
if (!firebase.apps.length) {
    firebase.initializeApp(firebaseConfig);
}
const database = firebase.database();

/* рдбреЗрдЯрд╛ рд╕реЗрд╡ рдХрд░рдиреЗ рдХрд╛ рдлрдВрдХреНрд╢рди */
function saveToFirebase(){
  // Input рд╕реЗ рд╡реИрд▓реНрдпреВ рд▓реЗрдирд╛
  const nameVal = document.getElementById("wname").value.trim();
  const phoneVal = document.getElementById("wphone").value.trim();
  const workVal = document.getElementById("workCategory").value;
  const villageVal = document.getElementById("villages").value.trim();
  
  const btn = document.getElementById("saveBtn");
  const status = document.getElementById("statusMsg");

  // Validation
  if(!nameVal || !phoneVal || !workVal || !villageVal){
    status.innerText = "тЭЧ рднрд╛рдИ, рдкреВрд░реА рдЬрд╛рдирдХрд╛рд░реА рднрд░реЗрдВ";
    status.style.color = "red";
    return;
  }

  // UI Update
  btn.disabled = true;
  btn.innerText = "рд╕реБрд░рдХреНрд╖рд┐рдд рд╣реЛ рд░рд╣рд╛ рд╣реИ...";
  status.innerText = "рдбреЗрдЯрд╛рдмреЗрд╕ рд╕реЗ рдХрдиреЗрдХреНрдЯ рд╣реЛ рд░рд╣рд╛ рд╣реИ...";
  status.style.color = "#ea580c";

  // .push() рд╕реЗ рдПрдХ рдпреВрдирд┐рдХ ID рдмрдирд╛рдирд╛
  const newRef = database.ref("workers").push();

  // рдбреЗрдЯрд╛ рд▓рд┐рдЦрдирд╛
  newRef.set({
    name: nameVal,
    phone: phoneVal,
    work: workVal,
    village: villageVal,
    time: firebase.database.ServerValue.TIMESTAMP
  })
  .then(() => {
    status.innerText = "";
    showSuccess();
  })
  .catch((err) => {
    btn.disabled = false;
    btn.innerText = "рдбреЗрдЯрд╛ рд╕реБрд░рдХреНрд╖рд┐рдд рдХрд░реЗрдВ";
    showError("рдиреЗрдЯрд╡рд░реНрдХ рдпрд╛ Rules рдХреА рд╕рдорд╕реНрдпрд╛: " + err.message);
  });
}

/* рдкреЙрдкрдЕрдк рдлрдВрдХреНрд╢рдиреНрд╕ */
function showSuccess(){
  document.getElementById("successBox").classList.remove("hidden");
}

function closeSuccess(){
  // рдбреЗрдЯрд╛ рд╕реЗрд╡ рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж рдкреЗрдЬ рд░рд┐рдлреНрд░реЗрд╢ рд╣реЛрдЧрд╛
  // рдЕрдЧрд░ рдЖрдк рдХрд┐рд╕реА рдЦрд╛рд╕ рдкреЗрдЬ рдкрд░ рднреЗрдЬрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рддреЛ рдпрд╣рд╛рдБ window.location.href = 'link' рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВ
  location.reload();
}

function showError(msg){
  document.getElementById("errorMsg").innerText = msg;
  document.getElementById("errorBox").classList.remove("hidden");
}

function closeError(){
  document.getElementById("errorBox").classList.add("hidden");
}
</script>

</body>
</html>
