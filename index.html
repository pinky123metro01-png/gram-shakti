<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gram Shakti | Final Fix</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Hind:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Hind', sans-serif; background-color: #f8fafc; padding-bottom: 90px; }
        .btn-main { background: #ea580c; color: white; padding: 12px; border-radius: 10px; width: 100%; font-weight: bold; margin-top: 15px; cursor: pointer; border: none; }
        input, select { border: 1px solid #e2e8f0; padding: 12px; border-radius: 10px; width: 100%; margin-top: 8px; outline: none; background: white; }
        .state-card { background: #ea580c; color: white; padding: 15px; border-radius: 12px; text-align: center; font-weight: bold; cursor: pointer; font-size: 14px; }
        .ad-container { background: #f1f5f9; border: 1px dashed #cbd5e1; text-align: center; font-size: 10px; color: #64748b; }
    </style>
</head>
<body class="max-w-md mx-auto min-h-screen bg-white shadow-2xl relative">

    <header class="flex items-center justify-between px-6 py-4 border-b bg-white sticky top-0 z-50">
        <div class="flex items-center gap-3">
            <div id="adminLogo" class="bg-orange-600 text-white w-10 h-10 flex items-center justify-center rounded-xl text-xl font-bold cursor-pointer select-none">G</div>
            <h1 class="font-bold text-lg text-gray-800">Gram Shakti</h1>
        </div>
        <p id="roleLabel" class="text-[10px] text-gray-400 font-bold uppercase">India</p>
    </header>

    <div id="topAdSlot" class="ad-container w-full h-20 flex items-center justify-center">Banner Ad Space</div>

    <div id="app" class="p-5"></div>

    <div class="fixed bottom-0 left-0 right-0 h-16 bg-white border-t flex items-center justify-center ad-container">Google AdSense Space</div>

<script>
// ‡§Ü‡§™‡§ï‡•á ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§®‡§∂‡•â‡§ü ‡§∏‡•á ‡§≤‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§¨‡§ø‡§≤‡•ç‡§ï‡•Å‡§≤ ‡§∏‡§π‡•Ä ‡§ï‡•â‡§®‡•ç‡§´‡§º‡§ø‡§ó‡§∞‡•á‡§∂‡§®
const firebaseConfig = {
  apiKey: "AIzaSyCuvev3-jwZwQu0_fHYyv2E2ovLny4LhRQ",
  authDomain: "gram-shakti-b135a.firebaseapp.com",
  projectId: "gram-shakti-b135a",
  storageBucket: "gram-shakti-b135a.appspot.com",
  messagingSenderId: "340909973482",
  appId: "1:340909973482:web:c562cb3dd591b78de21c93",
  databaseURL: "https://gram-shakti-b135a-default-rtdb.firebaseio.com"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let selected = { state: "", district: "", panchayat: "", village: "" };

// Admin Hold (G ‡§≤‡•ã‡§ó‡•ã ‡§¶‡§¨‡§æ‡§è‡§Å)
let timer;
document.getElementById("adminLogo").addEventListener("mousedown", () => {
    timer = setTimeout(() => {
        let p = prompt("Password:");
        if(p === "Vikas0627.") { alert("Admin Access Granted!"); }
    }, 3000);
});

function showStates() {
    const states = ['Andhra Pradesh', 'Arunachal Pradesh', 'Assam', 'Bihar', 'Chhattisgarh', 'Goa', 'Gujarat', 'Haryana', 'Himachal Pradesh', 'Jharkhand', 'Karnataka', 'Kerala', 'Madhya Pradesh', 'Maharashtra', 'Manipur', 'Meghalaya', 'Mizoram', 'Nagaland', 'Odisha', 'Punjab', 'Rajasthan', 'Sikkim', 'Tamil Nadu', 'Telangana', 'Tripura', 'Uttar Pradesh', 'Uttarakhand', 'West Bengal'];
    let h = `<h2 class="text-xl font-bold mb-4">‡§∞‡§æ‡§ú‡•ç‡§Ø ‡§ö‡•Å‡§®‡•á‡§Ç</h2><div class="grid grid-cols-2 gap-3">`;
    states.forEach(s => { h += `<div class="state-card" onclick="selected.state='${s}'; showDistrictInp()">${s}</div>`; });
    document.getElementById("app").innerHTML = h + `</div>`;
}

function showDistrictInp() { document.getElementById("app").innerHTML = `<h2>‡§ú‡§ø‡§≤‡§æ ‡§≤‡§ø‡§ñ‡•á‡§Ç</h2><input id="dist" placeholder="‡§ú‡§ø‡§≤‡§æ"><button onclick="selected.district=document.getElementById('dist').value; showPanchayatInp()" class="btn-main">‡§Ü‡§ó‡•á ‡§¨‡•ù‡•á‡§Ç</button>`; }
function showPanchayatInp() { document.getElementById("app").innerHTML = `<h2>‡§™‡§Ç‡§ö‡§æ‡§Ø‡§§ ‡§≤‡§ø‡§ñ‡•á‡§Ç</h2><input id="panch" placeholder="‡§™‡§Ç‡§ö‡§æ‡§Ø‡§§"><button onclick="selected.panchayat=document.getElementById('panch').value; showVillageInp()" class="btn-main">‡§Ü‡§ó‡•á ‡§¨‡•ù‡•á‡§Ç</button>`; }
function showVillageInp() { document.getElementById("app").innerHTML = `<h2>‡§ó‡§æ‡§Å‡§µ ‡§≤‡§ø‡§ñ‡•á‡§Ç</h2><input id="vill" placeholder="‡§ó‡§æ‡§Å‡§µ"><button onclick="selected.village=document.getElementById('vill').value; showOptions()" class="btn-main">‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç</button>`; }

function showOptions() {
    document.getElementById("app").innerHTML = `
        <div class="text-center py-4"><h2 class="text-2xl font-black">${selected.village}</h2><p class="text-gray-400">${selected.district}</p></div>
        <button onclick="workerForm()" class="btn-main h-14">ü§ù ‡§Æ‡•à‡§Ç ‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§∏‡§æ‡§•‡•Ä ‡§π‡•Ç‡§Å</button>
        <button onclick="customerView()" class="btn-main bg-white border-2 border-orange-600 !text-orange-600 h-14 mt-4">üîç ‡§∏‡•á‡§µ‡§æ ‡§¢‡•Ç‡§Å‡§¢‡•á‡§Ç</button>
    `;
}

function workerForm(){
  document.getElementById("app").innerHTML = `
    <h3 class="text-lg font-bold">‡§™‡§Ç‡§ú‡•Ä‡§ï‡§∞‡§£</h3>
    <input id="wname" placeholder="‡§Ü‡§™‡§ï‡§æ ‡§®‡§æ‡§Æ">
    <input id="wphone" type="tel" placeholder="‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞">
    <select id="work">
        <optgroup label="‡§Æ‡§∂‡•Ä‡§®‡§∞‡•Ä">
            <option value="JCB Operator">JCB ‡§ë‡§™‡§∞‡•á‡§ü‡§∞</option>
            <option value="Tractor Driver">‡§ü‡•ç‡§∞‡•à‡§ï‡•ç‡§ü‡§∞ ‡§°‡•ç‡§∞‡§æ‡§á‡§µ‡§∞</option>
        </optgroup>
        <optgroup label="‡§ï‡§æ‡§∞‡•Ä‡§ó‡§∞">
            <option value="Mistri">‡§∞‡§æ‡§ú‡§Æ‡§ø‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä</option>
            <option value="Electrician">‡§¨‡§ø‡§ú‡§≤‡•Ä ‡§Æ‡§ø‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä</option>
            <option value="Carpenter">‡§¨‡•ù‡§à</option>
        </optgroup>
        <optgroup label="‡§∏‡•á‡§µ‡§æ‡§è‡§Ç">
            <option value="Kirana Store">‡§ï‡§ø‡§∞‡§æ‡§®‡§æ ‡§¶‡•Å‡§ï‡§æ‡§®</option>
            <option value="Dairy/Milk">‡§¶‡•Ç‡§ß ‡§°‡•á‡§Ø‡§∞‡•Ä</option>
            <option value="Driver">‡§°‡•ç‡§∞‡§æ‡§á‡§µ‡§∞</option>
        </optgroup>
    </select>
    <input id="villages" placeholder="‡§ï‡§æ‡§Æ ‡§ï‡•á ‡§ó‡§æ‡§Å‡§µ (‡§ó‡§æ‡§Å‡§µ1, ‡§ó‡§æ‡§Å‡§µ2)">
    <button onclick="saveWorker()" id="saveBtn" class="btn-main">‡§°‡•á‡§ü‡§æ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç</button>
  `;
}

function saveWorker(){
  let name = document.getElementById("wname").value;
  let phone = document.getElementById("wphone").value;
  let vInput = document.getElementById("villages").value;
  let btn = document.getElementById("saveBtn");

  if(!name || !phone || !vInput) return alert("‡§™‡•Ç‡§∞‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§≠‡§∞‡•á‡§Ç!");

  btn.innerText = "‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...";
  btn.disabled = true;

  let id = Date.now();
  let vList = vInput.split(",");
  let vObj = {};
  vList.forEach(v => {
    let path = (selected.state+"/"+selected.district+"/"+selected.panchayat+"/"+v.trim()).replace(/\./g, '_');
    vObj[path] = true;
  });

  // Saving...
  db.ref("workers/" + id).set({
    name: name,
    work: document.getElementById("work").value,
    phone: phone,
    villages: vObj
  }).then(() => {
    alert("‡§¨‡§ß‡§æ‡§à ‡§π‡•ã! ‡§°‡•á‡§ü‡§æ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§π‡•ã ‡§ó‡§Ø‡§æ‡•§");
    showOptions();
  }).catch((e) => {
    alert("‡§ó‡•ú‡§¨‡•ú: " + e.message);
    btn.disabled = false;
    btn.innerText = "‡§°‡•á‡§ü‡§æ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç";
  });
}

function customerView() {
    document.getElementById("app").innerHTML = `<h3 class="font-bold mb-4">‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§∏‡§æ‡§•‡•Ä ‡§≤‡§ø‡§∏‡•ç‡§ü</h3><div id="list" class="space-y-3"></div>`;
    let currentPath = (selected.state+"/"+selected.district+"/"+selected.panchayat+"/"+selected.village).replace(/\./g, '_');
    db.ref("workers").once("value", snap => {
        let found = false;
        snap.forEach(w => {
            let data = w.val();
            if(JSON.stringify(data.villages).includes(currentPath)){
                found = true;
                document.getElementById("list").innerHTML += `
                <div class="p-3 border rounded-xl flex justify-between items-center bg-white shadow-sm">
                    <div><p class="font-bold">${data.name}</p><p class="text-orange-600 text-xs">${data.work}</p></div>
                    <a href="tel:${data.phone}" class="bg-green-600 text-white p-2 rounded-full">üìû</a>
                </div>`;
            }
        });
        if(!found) document.getElementById("list").innerHTML = "<p class='text-gray-400 text-center'>‡§ï‡•ã‡§à ‡§°‡•á‡§ü‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ‡•§</p>";
    });
}

showStates();
</script>
</body>
</html>
