<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§∂‡§ï‡•ç‡§§‡§ø - ‡§ó‡§æ‡§Å‡§µ ‡§ï‡•Ä ‡§°‡§ø‡§ú‡§ø‡§ü‡§≤ ‡§∏‡•á‡§µ‡§æ | Gram Shakti Official</title>
<meta name="description" content="‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§∂‡§ï‡•ç‡§§‡§ø (Gram Shakti): ‡§Ü‡§™‡§ï‡•á ‡§ó‡§æ‡§Å‡§µ ‡§ï‡•á ‡§∏‡§≠‡•Ä ‡§µ‡§∞‡•ç‡§ï‡§∞‡•ç‡§∏, ‡§ú‡•á‡§∏‡•Ä‡§¨‡•Ä, ‡§Æ‡§ø‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä ‡§î‡§∞ ‡§Æ‡§ú‡§¶‡•Ç‡§∞‡•ã‡§Ç ‡§ï‡•ã ‡§ñ‡•ã‡§ú‡§®‡•á ‡§ï‡§æ ‡§∏‡§¨‡§∏‡•á ‡§¨‡•ú‡§æ ‡§™‡•ç‡§≤‡•á‡§ü‡§´‡•â‡§∞‡•ç‡§Æ‡•§">

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@400;500;700&display=swap" rel="stylesheet">

<style>
  body { 
    background: linear-gradient(to bottom right, #fdf4eb, #fffde7, #e0f2fe);
    font-family: 'Noto Sans Devanagari', 'Poppins', sans-serif;
    min-height: 100vh; display: flex; flex-direction: column; align-items: center; padding: 20px;
  }
  .app-card {
    background: white; width: 100%; max-width: 480px; padding: 30px; border-radius: 20px;
    box-shadow: 0 15px 30px rgba(0,0,0,0.1); z-index: 10;
  }
  .ad-space {
    width: 100%; max-width: 480px; background: rgba(0,0,0,0.05);
    border: 1px dashed #ccc; margin: 10px 0; display: flex;
    align-items: center; justify-content: center; color: #888;
    font-size: 12px; border-radius: 10px; min-height: 60px;
  }
  .btn-primary {
    width: 100%; padding: 16px; background: linear-gradient(90deg, #f97316, #ea580c);
    color: white; border-radius: 14px; font-size: 18px; font-weight: 700;
    margin-top: 15px; cursor: pointer; box-shadow: 0 8px 20px rgba(249, 115, 22, 0.4);
  }
  #adminLogo {
    background: #2563eb; color: white; width: 44px; height: 44px;
    border-radius: 50%; display: flex; align-items: center; justify-content: center;
    font-size: 22px; font-weight: bold; cursor: pointer; 
  }
  .header-logo { font-family: 'Poppins', sans-serif; font-weight: 700; color: #f97316; font-size: 2rem; }
.back-btn {
    position: fixed;
    top: 15px;
    left: 10px;
    background: #2563eb;
    color: white;
    padding: 8px 15px;
    border-radius: 25px;
    display: flex;
    align-items: center;
    justify-content: center;
    border: none;
    font-size: 16px;
    font-weight: bold;
    z-index: 10000;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    cursor: pointer;
}

</style>
</head>
<body>
<button <a href="#" onclick="history.back(); return false;" class="back-btn">
    &#8592; Back
</a>
</button>

  <div style="text-align: center; margin: 15px 0;">
    <a href="https://github.com/gram-shakti-official/gram-shakti/releases/download/V1/gramshakti.apk">
        <img src="1770902092682 (1).png" alt="Gram Shakti App" style="width: 100%; max-width: 480px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.3);">
    </a>
</div>

  <div id="app-container" class="app-card">
    </div>

  <div style="text-align: center; margin: 15px 0;">
    <a href="https://github.com/gram-shakti-official/gram-shakti/releases/download/V1/gramshakti.apk">
        <img src="1770902092682 (2).png" alt="Install App" style="width: 100%; max-width: 480px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.3);">
    </a>
</div>
<script>
// 1. Firebase ‡§ï‡•â‡§®‡•ç‡§´‡§º‡§ø‡§ó‡§∞‡•á‡§∂‡§®
const firebaseConfig = {
  apiKey: "AIzaSyCuvev3-jwZwQuO_fHYyv2E2ovLny4Lh8Q",
  authDomain: "gram-shakti-b135a.firebaseapp.com",
  databaseURL: "https://gram-shakti-b135a-default-rtdb.firebaseio.com",
  projectId: "gram-shakti-b135a"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let userFlow = { state: '', jila: '', panchayat: '', village: '', role: '', service: '', delCharge: '', serviceAreas: [] };

// 2. ‡§¨‡•à‡§ï ‡§¨‡§ü‡§® ‡§≤‡•â‡§ú‡§ø‡§ï
function goBack() {
    if (document.getElementById('reg-form')) showServiceList();
    else if (document.getElementById('role-page')) showVillageStep();
    else if (document.getElementById('villInp')) showPanchayatStep();
    else if (document.getElementById('panchSelect')) showDistrictStep();
    else if (document.getElementById('distSelect')) showStates();
    else location.reload();
}

// 3. ‡§∞‡§æ‡§ú‡•ç‡§Ø ‡§ö‡§Ø‡§® ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§®
function showStates() {
    const states = ['Uttar Pradesh', 'Bihar', 'Rajasthan', 'Madhya Pradesh', 'Haryana', 'Uttarakhand', 'Jharkhand'];
    let html = `<h1 style="text-align:center; color:#f97316; font-size:30px; margin-bottom:5px;">‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§∂‡§ï‡•ç‡§§‡§ø</h1>
                <p style="text-align:center; color:#666; margin-bottom:20px;">‡§Ö‡§™‡§®‡§æ ‡§∞‡§æ‡§ú‡•ç‡§Ø ‡§ö‡•Å‡§®‡§ï‡§∞ ‡§Ü‡§ó‡•á ‡§¨‡•ù‡•á‡§Ç</p>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:12px; padding:10px;">`;
    states.forEach(s => {
        html += `<div onclick="userFlow.state='${s}'; showDistrictStep()" 
                 style="background:white; border-bottom:4px solid #f97316; padding:25px 10px; border-radius:15px; text-align:center; font-weight:bold; box-shadow:0 4px 10px rgba(0,0,0,0.1); cursor:pointer;">${s}</div>`;
    });
    document.getElementById('app-container').innerHTML = html + `</div>`;
}

// 4. ‡§ú‡§ø‡§≤‡§æ, ‡§™‡§Ç‡§ö‡§æ‡§Ø‡§§, ‡§ó‡§æ‡§Å‡§µ (‡§∏‡•ç‡§Æ‡§æ‡§∞‡•ç‡§ü ‡§°‡•ç‡§∞‡•â‡§™-‡§°‡§æ‡§â‡§® ‡§ï‡•á ‡§∏‡§æ‡§•)
function showDistrictStep() {
    let container = document.getElementById('app-container');
    container.innerHTML = `<div style="padding:15px;"><h3>‡§ú‡§ø‡§≤‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç (${userFlow.state})</h3>
    <select id="distSelect" style="width:100%; padding:15px; border-radius:15px; border:2px solid #f97316; margin:15px 0; font-weight:bold;">
        <option value="">-- ‡§™‡•Å‡§∞‡§æ‡§®‡§æ ‡§ú‡§ø‡§≤‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç --</option>
    </select>
    <div onclick="this.nextElementSibling.style.display='block'; this.style.display='none'" style="color:#2563eb; cursor:pointer; font-weight:bold; margin-bottom:10px;">+ ‡§®‡§Ø‡§æ ‡§ú‡§ø‡§≤‡§æ ‡§ú‡•ã‡•ú‡•á‡§Ç</div>
    <input type="text" id="distInp" placeholder="‡§®‡§Ø‡•á ‡§ú‡§ø‡§≤‡•á ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§≤‡§ø‡§ñ‡•á‡§Ç" style="display:none; width:100%; padding:15px; border-radius:12px; border:1px solid #ccc; margin-bottom:15px;">
    <button onclick="saveDistrict()" style="width:100%; padding:15px; background:#f97316; color:white; border:none; border-radius:15px; font-weight:bold;">‡§Ü‡§ó‡•á ‡§¨‡•ù‡•á‡§Ç</button></div>`;
    
    db.ref('users/').once('value', (snap) => {
        let set = new Set(); snap.forEach(c => { if(c.val().state === userFlow.state) set.add(c.val().jila); });
        set.forEach(d => { if(d) document.getElementById('distSelect').innerHTML += `<option value="${d}">${d}</option>`; });
    });
}
function saveDistrict() { let i = document.getElementById('distInp').value; userFlow.jila = i || document.getElementById('distSelect').value; if(!userFlow.jila){alert("‡§ú‡§ø‡§≤‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç"); return;} showPanchayatStep(); }

function showPanchayatStep() {
    let container = document.getElementById('app-container');
    container.innerHTML = `<div style="padding:15px;"><h3>‡§™‡§Ç‡§ö‡§æ‡§Ø‡§§ ‡§ö‡•Å‡§®‡•á‡§Ç (${userFlow.jila})</h3>
    <select id="panchSelect" style="width:100%; padding:15px; border-radius:15px; border:2px solid #f97316; margin:15px 0; font-weight:bold;">
        <option value="">-- ‡§™‡•Å‡§∞‡§æ‡§®‡•Ä ‡§™‡§Ç‡§ö‡§æ‡§Ø‡§§ ‡§ö‡•Å‡§®‡•á‡§Ç --</option>
    </select>
    <div onclick="this.nextElementSibling.style.display='block'; this.style.display='none'" style="color:#2563eb; cursor:pointer; font-weight:bold; margin-bottom:10px;">+ ‡§®‡§à ‡§™‡§Ç‡§ö‡§æ‡§Ø‡§§ ‡§ú‡•ã‡•ú‡•á‡§Ç</div>
    <input type="text" id="panchInp" placeholder="‡§®‡§Ø‡•Ä ‡§™‡§Ç‡§ö‡§æ‡§Ø‡§§ ‡§ï‡§æ ‡§®‡§æ‡§Æ" style="display:none; width:100%; padding:15px; border-radius:12px; border:1px solid #ccc; margin-bottom:15px;">
    <button onclick="savePanchayat()" style="width:100%; padding:15px; background:#f97316; color:white; border:none; border-radius:15px; font-weight:bold;">‡§Ü‡§ó‡•á ‡§¨‡•ù‡•á‡§Ç</button></div>`;
    
    db.ref('users/').once('value', (snap) => {
        let set = new Set(); snap.forEach(c => { if(c.val().jila === userFlow.jila) set.add(c.val().panchayat); });
        set.forEach(p => { if(p) document.getElementById('panchSelect').innerHTML += `<option value="${p}">${p}</option>`; });
    });
}
function savePanchayat() { let i = document.getElementById('panchInp').value; userFlow.panchayat = i || document.getElementById('panchSelect').value; if(!userFlow.panchayat){alert("‡§™‡§Ç‡§ö‡§æ‡§Ø‡§§ ‡§ö‡•Å‡§®‡•á‡§Ç"); return;} showVillageStep(); }

function showVillageStep() {
    let container = document.getElementById('app-container');
    container.innerHTML = `<div style="padding:15px;"><h3>‡§ó‡§æ‡§Å‡§µ ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§≤‡§ø‡§ñ‡•á‡§Ç</h3>
    <input type="text" id="villInp" placeholder="‡§ú‡•à‡§∏‡•á: ‡§∞‡§æ‡§Æ‡§™‡•Å‡§∞" style="width:100%; padding:15px; border-radius:15px; border:1px solid #ccc; margin-bottom:15px;">
    <button onclick="saveVillage()" style="width:100%; padding:15px; background:#f97316; color:white; border:none; border-radius:15px; font-weight:bold;">‡§Ü‡§ó‡•á ‡§¨‡•ù‡•á‡§Ç</button></div>`;
}
function saveVillage() { userFlow.village = document.getElementById('villInp').value; if(!userFlow.village){alert("‡§®‡§æ‡§Æ ‡§≤‡§ø‡§ñ‡•á‡§Ç"); return;} showRoleSelection(); }

// 5. ‡§≠‡•Ç‡§Æ‡§ø‡§ï‡§æ ‡§ö‡§Ø‡§® (Role Selection)
function showRoleSelection() {
    let container = document.getElementById('app-container');
    container.innerHTML = `<div id="role-page" style="padding:20px; text-align:center;">
        <h2 style="color:#333;">‡§Ü‡§™ ‡§ï‡•å‡§® ‡§π‡•à‡§Ç?</h2>
        <div onclick="userFlow.role='worker'; showServiceList()" style="background:linear-gradient(135deg, #2563eb, #1e40af); color:white; padding:30px; border-radius:20px; margin:20px 0; font-size:22px; font-weight:bold; box-shadow:0 8px 15px rgba(37,99,235,0.3);">‡§Æ‡•à‡§Ç ‡§µ‡§∞‡•ç‡§ï‡§∞/‡§¶‡•Å‡§ï‡§æ‡§®‡§¶‡§æ‡§∞ ‡§π‡•Ç‡§Å</div>
        <div onclick="userFlow.role='customer'; showServiceList()" style="background:linear-gradient(135deg, #16a34a, #15803d); color:white; padding:30px; border-radius:20px; margin:20px 0; font-size:22px; font-weight:bold; box-shadow:0 8px 15px rgba(22,163,74,0.3);">‡§Æ‡•Å‡§ù‡•á ‡§∏‡§∞‡•ç‡§µ‡§ø‡§∏/‡§∏‡§æ‡§Æ‡§æ‡§® ‡§ö‡§æ‡§π‡§ø‡§è</div>
    </div>`;
}

// 6. ‡§∏‡§∞‡•ç‡§µ‡§ø‡§∏ ‡§≤‡§ø‡§∏‡•ç‡§ü (‡§∏‡§à ‡§∏‡•á JCB ‡§§‡§ï)
function showServiceList() {
    const services = ['‡§°‡•á‡§Ø‡§∞‡•Ä/‡§¶‡•Ç‡§ß', '‡§ï‡§ø‡§∞‡§æ‡§®‡§æ ‡§¶‡•Å‡§ï‡§æ‡§®', '‡§Æ‡§ø‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä (‡§Æ‡§ï‡§æ‡§®)', 'JCB ‡§Æ‡§∂‡•Ä‡§®', '‡§ü‡•ç‡§∞‡•à‡§ï‡•ç‡§ü‡§∞/‡§ü‡•ç‡§∞‡•â‡§≤‡•Ä', '‡§™‡•ç‡§≤‡§Æ‡•ç‡§¨‡§∞', '‡§á‡§≤‡•á‡§ï‡•ç‡§ü‡•ç‡§∞‡•Ä‡§∂‡§ø‡§Ø‡§®', '‡§Æ‡•õ‡§¶‡•Ç‡§∞', '‡§ü‡•á‡§≤‡§∞ (‡§¶‡§∞‡•ç‡§ú‡•Ä)', '‡§Æ‡•à‡§ï‡•á‡§®‡§ø‡§ï', '‡§™‡•á‡§Ç‡§ü‡§∞', '‡§µ‡•á‡§≤‡•ç‡§°‡§ø‡§Ç‡§ó ‡§µ‡§∞‡•ç‡§ï'];
    let html = `<div style="padding:15px;"><h3>‡§∏‡•á‡§µ‡§æ/‡§¶‡•Å‡§ï‡§æ‡§® ‡§ö‡•Å‡§®‡•á‡§Ç</h3><div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; max-height:400px; overflow-y:auto;">`;
    services.forEach(s => {
        html += `<div onclick="userFlow.service='${s}'; ${userFlow.role === 'worker' ? 'showRegistrationForm()' : 'showList()'}" style="background:#fff; border:1px solid #ddd; padding:15px; border-radius:12px; text-align:center; font-weight:bold; cursor:pointer; box-shadow:0 2px 5px rgba(0,0,0,0.05);">${s}</div>`;
    });
    document.getElementById('app-container').innerHTML = html + `</div></div>`;
}

// 7. ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•á‡§∂‡§® ‡§´‡•â‡§∞‡•ç‡§Æ (‡§°‡§ø‡§≤‡•Ä‡§µ‡§∞‡•Ä ‡§ö‡§æ‡§∞‡•ç‡§ú ‡§î‡§∞ ‡§∏‡§∞‡•ç‡§µ‡§ø‡§∏ ‡§è‡§∞‡§ø‡§Ø‡§æ ‡§ï‡•á ‡§∏‡§æ‡§•)
function showRegistrationForm() {
    let isShop = (userFlow.service === '‡§°‡•á‡§Ø‡§∞‡•Ä/‡§¶‡•Ç‡§ß' || userFlow.service === '‡§ï‡§ø‡§∞‡§æ‡§®‡§æ ‡§¶‡•Å‡§ï‡§æ‡§®');
    let container = document.getElementById('app-container');
    container.innerHTML = `
        <div id="reg-form" style="padding:20px; background:#f9fafb; border-radius:25px; margin:10px; box-shadow:0 10px 25px rgba(0,0,0,0.05);">
            <h3 style="color:#2563eb; margin-bottom:20px;">${userFlow.service} ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•á‡§∂‡§®</h3>
            <input type="text" id="wName" placeholder="‡§Ü‡§™‡§ï‡§æ/‡§¶‡•Å‡§ï‡§æ‡§® ‡§ï‡§æ ‡§®‡§æ‡§Æ" style="width:100%; padding:15px; margin-bottom:12px; border-radius:12px; border:1px solid #ccc;">
            <input type="number" id="wPhone" placeholder="‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞" style="width:100%; padding:15px; margin-bottom:12px; border-radius:12px; border:1px solid #ccc;">
            
            ${isShop ? `
                <p style="font-size:13px; color:#d97706; font-weight:bold;">üöö ‡§π‡•ã‡§Æ ‡§°‡§ø‡§≤‡•Ä‡§µ‡§∞‡•Ä ‡§ö‡§æ‡§∞‡•ç‡§ú (‡§ú‡•à‡§∏‡•á: ‚Çπ20 ‡§™‡•ç‡§∞‡§§‡§ø 3km):</p>
                <input type="text" id="wCharge" placeholder="‡§Ø‡§π‡§æ‡§Å ‡§°‡§ø‡§≤‡•Ä‡§µ‡§∞‡•Ä ‡§∞‡•á‡§ü ‡§≤‡§ø‡§ñ‡•á‡§Ç" style="width:100%; padding:15px; margin-bottom:12px; border-radius:12px; border:1px solid #ccc;">
            ` : ''}

            <p style="font-size:12px; color:#666;"><b>‡§ú‡§ø‡§® ‡§ó‡§æ‡§Å‡§µ‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§∏‡•á‡§µ‡§æ ‡§¶‡•á ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç (‡§ï‡•ã‡§Æ‡§æ , ‡§≤‡§ó‡§æ‡§ï‡§∞):</b></p>
            <textarea id="wAreas" placeholder="‡§ó‡§æ‡§Å‡§µ1, ‡§ó‡§æ‡§Å‡§µ2, ‡§ó‡§æ‡§Å‡§µ3..." style="width:100%; height:80px; padding:12px; border-radius:12px; border:1px solid #ccc; margin-bottom:15px;"></textarea>
            
            <button onclick="finalRegister()" style="width:100%; padding:18px; background:#2563eb; color:white; border:none; border-radius:15px; font-weight:bold; font-size:18px;">‡§Ö‡§≠‡•Ä ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞ ‡§ï‡§∞‡•á‡§Ç</button>
        </div>`;
}

function finalRegister() {
    userFlow.workerName = document.getElementById('wName').value;
    userFlow.workerPhone = document.getElementById('wPhone').value;
    userFlow.delCharge = document.getElementById('wCharge') ? document.getElementById('wCharge').value : 'NA';
    let areas = document.getElementById('wAreas').value;
    
    if(!userFlow.workerName || !userFlow.workerPhone) { alert("‡§ï‡•É‡§™‡§Ø‡§æ ‡§®‡§æ‡§Æ ‡§î‡§∞ ‡§®‡§Ç‡§¨‡§∞ ‡§≠‡§∞‡•á‡§Ç"); return; }
    
    userFlow.serviceAreas = areas.split(',').map(item => item.trim().toLowerCase());
    userFlow.serviceAreas.push(userFlow.village.toLowerCase());

    db.ref('users/').push(userFlow).then(() => {
        alert("‡§¨‡§ß‡§æ‡§à ‡§π‡•ã! ‡§Ü‡§™‡§ï‡§æ ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•á‡§∂‡§® ‡§∏‡§´‡§≤ ‡§∞‡§π‡§æ‡•§");
        location.reload();
<script>
// 1. Firebase ‡§ï‡•â‡§®‡•ç‡§´‡§º‡§ø‡§ó‡§∞‡•á‡§∂‡§®
const firebaseConfig = {
  apiKey: "AIzaSyCuvev3-jwZwQuO_fHYyv2E2ovLny4Lh8Q",
  authDomain: "gram-shakti-b135a.firebaseapp.com",
  databaseURL: "https://gram-shakti-b135a-default-rtdb.firebaseio.com",
  projectId: "gram-shakti-b135a"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let userFlow = { state: '', jila: '', panchayat: '', village: '', role: '', service: '', delCharge: '', serviceAreas: [] };

// 2. ‡§¨‡•à‡§ï ‡§¨‡§ü‡§® ‡§ï‡§æ ‡§∏‡§¨‡§∏‡•á ‡§∏‡§ü‡•Ä‡§ï ‡§´‡§Ç‡§ï‡•ç‡§∂‡§® (Fix)
function goBack() {
    if (document.getElementById('list-container')) { showServiceList(); }
    else if (document.getElementById('reg-form')) { showServiceList(); }
    else if (document.getElementById('service-list-page')) { showRoleSelection(); }
    else if (document.getElementById('role-page')) { showVillageStep(); }
    else if (document.getElementById('vill-page')) { showPanchayatStep(); }
    else if (document.getElementById('panch-page')) { showDistrictStep(); }
    else if (document.getElementById('dist-page')) { showStates(); }
    else { location.reload(); }
}

// 3. ‡§∞‡§æ‡§ú‡•ç‡§Ø ‡§ö‡§Ø‡§® (ID: dist-page ‡§ï‡•á ‡§≤‡§ø‡§è)
function showStates() {
    const states = ['Uttar Pradesh', 'Bihar', 'Rajasthan', 'Madhya Pradesh', 'Haryana', 'Uttarakhand', 'Jharkhand'];
    let html = `<h1 style="text-align:center; color:#f97316;">‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§∂‡§ï‡•ç‡§§‡§ø</h1><div id="state-page" style="display:grid; grid-template-columns: 1fr 1fr; gap:12px; padding:15px;">`;
    states.forEach(s => {
        html += `<div onclick="userFlow.state='${s}'; showDistrictStep()" style="background:white; border-bottom:4px solid #f97316; padding:20px; border-radius:15px; text-align:center; font-weight:bold; box-shadow:0 4px 10px rgba(0,0,0,0.1);">${s}</div>`;
    });
    document.getElementById('app-container').innerHTML = html + `</div>`;
}

// 4. ‡§ú‡§ø‡§≤‡§æ ‡§ö‡§Ø‡§® (ID: dist-page)
function showDistrictStep() {
    let container = document.getElementById('app-container');
    container.innerHTML = `<div id="dist-page" style="padding:15px;"><h3>‡§ú‡§ø‡§≤‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç</h3><select id="distSelect" style="width:100%; padding:15px; border-radius:15px; border:2px solid #f97316; margin:15px 0;"></select><button onclick="saveDistrict()" style="width:100%; padding:15px; background:#f97316; color:white; border:none; border-radius:15px; font-weight:bold;">‡§Ü‡§ó‡•á ‡§¨‡•ù‡•á‡§Ç</button></div>`;
    db.ref('users/').once('value', (snap) => {
        let set = new Set(); snap.forEach(c => { if(c.val().state === userFlow.state) set.add(c.val().jila); });
        let sel = document.getElementById('distSelect'); sel.innerHTML = '<option value="">-- ‡§ö‡•Å‡§®‡•á‡§Ç --</option>';
        set.forEach(d => { if(d) sel.innerHTML += `<option value="${d}">${d}</option>`; });
    });
}
function saveDistrict() { userFlow.jila = document.getElementById('distSelect').value; if(!userFlow.jila) return; showPanchayatStep(); }

// 5. ‡§™‡§Ç‡§ö‡§æ‡§Ø‡§§ ‡§ö‡§Ø‡§® (ID: panch-page)
function showPanchayatStep() {
    let container = document.getElementById('app-container');
    container.innerHTML = `<div id="panch-page" style="padding:15px;"><h3>‡§™‡§Ç‡§ö‡§æ‡§Ø‡§§ ‡§ö‡•Å‡§®‡•á‡§Ç</h3><select id="panchSelect" style="width:100%; padding:15px; border-radius:15px; border:2px solid #f97316; margin:15px 0;"></select><button onclick="savePanchayat()" style="width:100%; padding:15px; background:#f97316; color:white; border:none; border-radius:15px; font-weight:bold;">‡§Ü‡§ó‡•á ‡§¨‡•ù‡•á‡§Ç</button></div>`;
    db.ref('users/').once('value', (snap) => {
        let set = new Set(); snap.forEach(c => { if(c.val().jila === userFlow.jila) set.add(c.val().panchayat); });
        let sel = document.getElementById('panchSelect'); sel.innerHTML = '<option value="">-- ‡§ö‡•Å‡§®‡•á‡§Ç --</option>';
        set.forEach(p => { if(p) sel.innerHTML += `<option value="${p}">${p}</option>`; });
    });
}
function savePanchayat() { userFlow.panchayat = document.getElementById('panchSelect').value; if(!userFlow.panchayat) return; showVillageStep(); }

// 6. ‡§ó‡§æ‡§Å‡§µ (ID: vill-page)
function showVillageStep() {
    let container = document.getElementById('app-container');
    container.innerHTML = `<div id="vill-page" style="padding:15px;"><h3>‡§ó‡§æ‡§Å‡§µ ‡§≤‡§ø‡§ñ‡•á‡§Ç</h3><input type="text" id="villInp" placeholder="‡§ó‡§æ‡§Å‡§µ ‡§ï‡§æ ‡§®‡§æ‡§Æ" style="width:100%; padding:15px; border-radius:15px; border:1px solid #ccc; margin-bottom:15px;"><button onclick="saveVillage()" style="width:100%; padding:15px; background:#f97316; color:white; border:none; border-radius:15px; font-weight:bold;">‡§Ü‡§ó‡•á ‡§¨‡•ù‡•á‡§Ç</button></div>`;
}
function saveVillage() { userFlow.village = document.getElementById('villInp').value; if(!userFlow.village) return; showRoleSelection(); }

// 7. ‡§∞‡•ã‡§≤ (ID: role-page)
function showRoleSelection() {
    let container = document.getElementById('app-container');
    container.innerHTML = `<div id="role-page" style="padding:20px; text-align:center;"><h2>‡§Ü‡§™ ‡§ï‡•å‡§® ‡§π‡•à‡§Ç?</h2><div onclick="userFlow.role='worker'; showServiceList()" style="background:#2563eb; color:white; padding:25px; border-radius:20px; margin:15px 0; font-weight:bold; cursor:pointer;">‡§Æ‡•à‡§Ç ‡§µ‡§∞‡•ç‡§ï‡§∞/‡§¶‡•Å‡§ï‡§æ‡§®‡§¶‡§æ‡§∞ ‡§π‡•Ç‡§Å</div><div onclick="userFlow.role='customer'; showServiceList()" style="background:#16a34a; color:white; padding:25px; border-radius:20px; margin:15px 0; font-weight:bold; cursor:pointer;">‡§Æ‡•Å‡§ù‡•á ‡§∏‡§∞‡•ç‡§µ‡§ø‡§∏/‡§∏‡§æ‡§Æ‡§æ‡§® ‡§ö‡§æ‡§π‡§ø‡§è</div></div>`;
}

// 8. ‡§∏‡§∞‡•ç‡§µ‡§ø‡§∏ ‡§≤‡§ø‡§∏‡•ç‡§ü (ID: service-list-page)
function showServiceList() {
    const services = ['‡§°‡•á‡§Ø‡§∞‡•Ä/‡§¶‡•Ç‡§ß', '‡§ï‡§ø‡§∞‡§æ‡§®‡§æ ‡§¶‡•Å‡§ï‡§æ‡§®', '‡§Æ‡§ø‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä (‡§Æ‡§ï‡§æ‡§®)', 'JCB ‡§Æ‡§∂‡•Ä‡§®', '‡§ü‡•ç‡§∞‡•à‡§ï‡•ç‡§ü‡§∞', '‡§á‡§≤‡•á‡§ï‡•ç‡§ü‡•ç‡§∞‡•Ä‡§∂‡§ø‡§Ø‡§®', '‡§™‡•ç‡§≤‡§Æ‡•ç‡§¨‡§∞', '‡§Æ‡•õ‡§¶‡•Ç‡§∞'];
    let html = `<div id="service-list-page" style="padding:15px;"><h3>‡§∏‡•á‡§µ‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç</h3><div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">`;
    services.forEach(s => {
        html += `<div onclick="userFlow.service='${s}'; ${userFlow.role === 'worker' ? 'showRegistrationForm()' : 'showList()'}" style="background:#fff; border:1px solid #ddd; padding:15px; border-radius:12px; text-align:center; font-weight:bold; cursor:pointer;">${s}</div>`;
    });
    document.getElementById('app-container').innerHTML = html + `</div></div>`;
}

// 9. ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•á‡§∂‡§® (ID: reg-form)
function showRegistrationForm() {
    let isShop = (userFlow.service === '‡§°‡•á‡§Ø‡§∞‡•Ä/‡§¶‡•Ç‡§ß' || userFlow.service === '‡§ï‡§ø‡§∞‡§æ‡§®‡§æ ‡§¶‡•Å‡§ï‡§æ‡§®');
    document.getElementById('app-container').innerHTML = `
        <div id="reg-form" style="padding:20px; background:#f4f4f4; border-radius:20px; margin:10px;">
            <h3>${userFlow.service} ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•á‡§∂‡§®</h3>
            <input type="text" id="wName" placeholder="‡§®‡§æ‡§Æ/‡§¶‡•Å‡§ï‡§æ‡§® ‡§ï‡§æ ‡§®‡§æ‡§Æ" style="width:100%; padding:15px; margin-bottom:10px; border-radius:10px;">
            <input type="number" id="wPhone" placeholder="‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞" style="width:100%; padding:15px; margin-bottom:10px; border-radius:10px;">
            ${isShop ? `<input type="text" id="wCharge" placeholder="‡§°‡§ø‡§≤‡•Ä‡§µ‡§∞‡•Ä ‡§ö‡§æ‡§∞‡•ç‡§ú" style="width:100%; padding:15px; margin-bottom:10px; border-radius:10px;">` : ''}
            <textarea id="wAreas" placeholder="‡§Ö‡§®‡•ç‡§Ø ‡§ó‡§æ‡§Å‡§µ (‡§ï‡•ã‡§Æ‡§æ ‡§≤‡§ó‡§æ‡§ï‡§∞)" style="width:100%; padding:10px; border-radius:10px;"></textarea>
            <button onclick="finalRegister()" style="width:100%; padding:15px; background:#2563eb; color:white; border:none; border-radius:12px; margin-top:15px; font-weight:bold;">‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞ ‡§ï‡§∞‡•á‡§Ç</button>
        </div>`;
}

function finalRegister() {
    userFlow.workerName = document.getElementById('wName').value;
    userFlow.workerPhone = document.getElementById('wPhone').value;
    userFlow.delCharge = document.getElementById('wCharge') ? document.getElementById('wCharge').value : 'NA';
    let areas = document.getElementById('wAreas').value;
    userFlow.serviceAreas = areas.split(',').map(i => i.trim().toLowerCase());
    userFlow.serviceAreas.push(userFlow.village.toLowerCase());
    db.ref('users/').push(userFlow).then(() => { alert("‡§∏‡§´‡§≤!"); location.reload(); });
}

// 10. ‡§µ‡§∞‡•ç‡§ï‡§∞ ‡§≤‡§ø‡§∏‡•ç‡§ü ‡§¶‡§ø‡§ñ‡§æ‡§®‡§æ (Fix: ID check)
function showList() {
    document.getElementById('app-container').innerHTML = `<div id="list-container" style="padding:15px;"><h3>‡§â‡§™‡§≤‡§¨‡•ç‡§ß ${userFlow.service}</h3><div id="list-box">‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</div><button onclick="goBack()" style="width:100%; margin-top:20px; padding:10px; border-radius:10px;">‡§µ‡§æ‡§™‡§∏ ‡§ú‡§æ‡§è‡§Å</button></div>`;
    db.ref('users/').once('value', (snap) => {
        let html = ''; let found = false;
        let v = userFlow.village.toLowerCase();
        snap.forEach(child => {
            let d = child.val();
            // ‡§Ø‡§π‡§æ‡§Å ‡§ö‡•á‡§ï ‡§ï‡§∞ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç ‡§ï‡§ø ‡§ï‡•ç‡§Ø‡§æ ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ï‡§æ ‡§ó‡§æ‡§Å‡§µ ‡§µ‡§∞‡•ç‡§ï‡§∞ ‡§ï‡•á ‡§è‡§∞‡§ø‡§Ø‡§æ ‡§Æ‡•á‡§Ç ‡§π‡•à
            if(d.role === 'worker' && d.service === userFlow.service && d.serviceAreas && d.serviceAreas.includes(v)) {
                html += `<div style="background:white; padding:15px; border-radius:15px; margin-bottom:10px; display:flex; justify-content:space-between; align-items:center; box-shadow:0 3px 6px rgba(0,0,0,0.1);">
                            <div><b>${d.workerName}</b><br><small>‡§ö‡§æ‡§∞‡•ç‡§ú: ${d.delCharge}</small></div>
                            <a href="tel:${d.workerPhone}" style="background:#16a34a; color:white; width:40px; height:40px; border-radius:50%; display:flex; align-items:center; justify-content:center; text-decoration:none;">üìû</a>
                         </div>`;
                found = true;
            }
        });
        document.getElementById('list-box').innerHTML = found ? html : "‡§ï‡•ã‡§à ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ‡•§";
    });
}

showStates();
</script>
